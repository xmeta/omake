<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<META name="GENERATOR" content="hevea 1.09">
<LINK rel="stylesheet" type="text/css" href="omake-doc.css">
<TITLE>Autoconfiguration functions and variables</TITLE>
</HEAD>
<BODY >

<img src="images/omake-manual.gif" border="0" align="top" alt=""><br>

<TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP>Jump to:</TD><TD VALIGN=top ALIGN=center NOWRAP>&#XA0;&#XA0;</TD><TD ALIGN=left NOWRAP><A HREF="http://omake.metaprl.org/">OMake Home</A>
&bull;&nbsp;<A HREF="omake.html">Guide Home</A>
&bull;&nbsp;<A HREF="omake-doc.html">Guide (single-page)</A>
&bull;&nbsp;<A HREF="omake-toc.html">Contents (short)</A>
&bull;&nbsp;<A HREF="omake-contents.html">Contents (long)</A></TD></TR>
<TR><TD ALIGN=left NOWRAP>Index:</TD><TD VALIGN=top ALIGN=center NOWRAP>&#XA0;&#XA0;</TD><TD ALIGN=left NOWRAP><A HREF="omake-all-index.html">All</A>
&bull;&nbsp;<A HREF="omake-var-index.html">Variables</A>
&bull;&nbsp;<A HREF="omake-fun-index.html">Functions</A>
&bull;&nbsp;<A HREF="omake-obj-index.html">Objects</A>
&bull;&nbsp;<A HREF="omake-target-index.html">Targets</A>
&bull;&nbsp;<A HREF="omake-option-index.html">Options</A></TD></TR>
</TABLE>
<H1 CLASS="chapter"><A NAME="htoc379">Chapter&#XA0;13</A>&#XA0;&#XA0;Autoconfiguration functions and variables</H1><UL>
<LI><A HREF="omake-autoconf.html#toc101">General-purpose autoconfiguration functions</A></LI>
<LI><A HREF="omake-autoconf.html#toc102">Predefined configuration tests</A></LI>
</UL>
<P>
<A NAME="chapter:autoconf"></A>
</P><P>
OMake standard library provides a number of functions and variables intended to help one write
build specifications that need to be capable of autoconfiguring itself to adjust to different
build environments.</P><H2 CLASS="section"><A NAME="toc101"></A><A NAME="htoc380">13.1</A>&#XA0;&#XA0;General-purpose autoconfiguration functions</H2><P>
The following general-purpose functions can be used to discover the properties of your build
environment in a fashion similar to the one used by GNU autoconf tool you may be familiar with.
It is recommended that these function be used from an appropriate <CODE>static.</CODE> block (see
Section&#XA0;<A HREF="omake-language.html#section:static.">4.18</A> for more information).</P><P>In order to use the following general-purpose functions, you need to have the line
</P><PRE CLASS="verbatim">open configure/Configure
</PRE><P>included in your <CODE>OMakefile</CODE> or <CODE>OMakeroot</CODE>.
</P><H3 CLASS="subsection"><A NAME="htoc381">13.1.1</A>&#XA0;&#XA0;AC_MSG_CHECKING, AC_MSG_RESULT</H3><P><A NAME="fun:AC_MSG_CHECKING"></A><A NAME="@default453"></A><A NAME="@fun253"></A><A NAME="fun:AC_MSG_RESULT"></A><A NAME="@default454"></A><A NAME="@fun254"></A>
</P><PRE CLASS="verbatim">AC_MSG_CHECKING(&lt;msg&gt;)
...
AC_MSG_RESULT(&lt;msg&gt;)
</PRE><P>The <CODE>AC_MSG_CHECKING</CODE> function output message of the form <CODE>--- Checking &lt;msg&gt;... </CODE>
<EM>without</EM> any trailing newline. After the test advertized by <CODE>AC_MSG_CHECKING</CODE> is
performed, the <CODE>AC_MSG_RESULT</CODE> function should be used to output the result.</P><P>In certain cases users may want to redefine these function &#X2014; for example, to use a different
output formatting and/or to copy the messages to a log file.</P><P>Example:
</P><PRE CLASS="verbatim">static. =
   AC_MSG_CHECKING(which foo to use)
   foo = ...
   AC_MSG_RESULT($(foo))
</PRE><H3 CLASS="subsection"><A NAME="htoc382">13.1.2</A>&#XA0;&#XA0;AC_MSG_WARN, AC_MSG_ERROR</H3><P><A NAME="fun:AC_MSG_WARN"></A><A NAME="@default455"></A><A NAME="@fun255"></A><A NAME="fun:AC_MSG_ERROR"></A><A NAME="@default456"></A><A NAME="@fun256"></A>
</P><PRE CLASS="verbatim">AC_MSG_WARN(&lt;msg&gt;)
AC_MSG_ERROR(&lt;msg&gt;)
</PRE><P>Print a warning or an error message respectively. <CODE>AC_MSG_ERROR</CODE> would then abort OMake.
</P><H3 CLASS="subsection"><A NAME="htoc383">13.1.3</A>&#XA0;&#XA0;AC_MSG_YES_NO, AC_MSG_FOUND</H3><P><A NAME="fun:AC_MSG_YES_NO"></A><A NAME="@default457"></A><A NAME="@fun257"></A><A NAME="fun:AC_MSG_FOUND"></A><A NAME="@default458"></A><A NAME="@fun258"></A>
</P><PRE CLASS="verbatim">flag = $(AC_MSG_YES_NO &lt;bool expr&gt;
flag = $(AC_MSG_FOUND &lt;bool expr&gt;
</PRE><P>The <CODE>AC_MSG_FOUND</CODE> function expects to receive a boolean flag describing whether a test
previously announced using the <A HREF="#fun:AC_MSG_CHECKING"><CODE>AC_MSG_CHECKING</CODE> function</A> found what it
was looking for. <CODE>AC_MSG_FOUND</CODE> will output the appropriate result (&#X201C;found&#X201D; or &#X201C;NOT found&#X201D;)
using the <A HREF="#fun:AC_MSG_RESULT"><CODE>AC_MSG_RESULT</CODE> function</A> and return its argument back.</P><P>The <CODE>AC_MSG_YES_NO</CODE> function is similar, outputting a simple (&#X201C;yes&#X201D; or &#X201C;NO&#X201D;).
</P><H3 CLASS="subsection"><A NAME="htoc384">13.1.4</A>&#XA0;&#XA0;AC_TRY_COMPILE, AC_TRY_LINK, AC_TRY_RUN</H3><P><A NAME="fun:AC_TRY_COMPILE"></A><A NAME="@default459"></A><A NAME="@fun259"></A><A NAME="fun:AC_TRY_LINK"></A><A NAME="@default460"></A><A NAME="@fun260"></A><A NAME="fun:AC_TRY_RUN"></A><A NAME="@default461"></A><A NAME="@fun261"></A>
</P><PRE CLASS="verbatim">success = $(AC_TRY_COMPILE &lt;prog_text&gt;)
success = $(AC_TRY_LINK &lt;prog_text&gt;)
success = $(AC_TRY_RUN &lt;prog_text&gt;)
</PRE><P>Given the <EM>text</EM> of a C program, the <CODE>AC_TRY_COMPILE</CODE>, <CODE>AC_TRY_LINK</CODE>, and <CODE>AC_TRY_RUN</CODE>
functions would try to compile / compile and link / compile, link, and run, the given program and return a boolean flag
indicating whether the attempt was successful.</P><P><CODE>AC_TRY_COMPILE</CODE> will use the <CODE><A HREF="omake-build.html#var:CC">CC</A></CODE>, <CODE><A HREF="omake-build.html#var:CFLAGS">CFLAGS</A></CODE> and <CODE><A HREF="omake-build.html#var:INCLUDES">INCLUDES</A></CODE> variables 
to run the C compiler. <CODE>AC_TRY_LINK</CODE> and <CODE>AC_TRY_RUN</CODE> will also use the <A HREF="omake-build.html#var:LDFLAGS"><CODE>LDFLAGS</CODE> variable</A>
to run the C compiler and linker. However, the flags like <CODE>/WX</CODE>, <CODE>-Werror</CODE> and <CODE>-warn-error</CODE>
will be not be passed to the compiler, even if they occur in <CODE>CFLAGS</CODE>.</P><P>These functions are silent and should normally be used with an appropriate
<CODE><A HREF="#fun:AC_MSG_CHECKING">AC_MSG_CHECKING</A></CODE> &#X2026; <CODE><A HREF="#fun:AC_MSG_RESULT">AC_MSG_RESULT</A></CODE>.
</P><H3 CLASS="subsection"><A NAME="htoc385">13.1.5</A>&#XA0;&#XA0;AC_RUN_PROG</H3><P><A NAME="fun:AC_RUN_PROG"></A><A NAME="@default462"></A><A NAME="@fun262"></A>
</P><PRE CLASS="verbatim">output = $(AC_RUN_PROG &lt;prog&gt;)
</PRE><P><CODE>AC_RUN_PROG</CODE> is similar to the <CODE><A HREF="#fun:AC_RUN_PROG">AC_RUN_PROG</A></CODE>, except that it
returns the output of the function (will return <CODE>false</CODE> if the program fails to compile
or run).
</P><H3 CLASS="subsection"><A NAME="htoc386">13.1.6</A>&#XA0;&#XA0;CheckHeader, VerboseCheckHeader</H3><P><A NAME="fun:CheckHeader"></A><A NAME="@default463"></A><A NAME="@fun263"></A><A NAME="fun:VerboseCheckHeader"></A><A NAME="@default464"></A><A NAME="@fun264"></A>
</P><PRE CLASS="verbatim">success = $(CheckHeader &lt;files&gt;)
success = $(VerboseCheckHeader &lt;files&gt;)
</PRE><P>Use the <A HREF="#fun:AC_TRY_COMPILE"><CODE>AC_TRY_COMPILE</CODE> function</A> to check whether your C compiler can locate
and process the specified headers files.
Will incude <CODE>&lt;stdio.h&gt;</CODE> before including the header files.</P><P>Both functions return a boolean value. The <CODE>CheckHeader</CODE> function is silent; the
<CODE>VerboseCheckHeader</CODE> function will use the <CODE><A HREF="#fun:AC_MSG_CHECKING">AC_MSG_CHECKING</A></CODE> and
<CODE><A HREF="#fun:AC_MSG_RESULT">AC_MSG_RESULT</A></CODE> functions to describe the test and the outcome.</P><P>Example:
</P><PRE CLASS="verbatim">static. =
   NCURSES_H_AVAILABLE = $(VerboseCheckHeader ncurses.h)
</PRE><H3 CLASS="subsection"><A NAME="htoc387">13.1.7</A>&#XA0;&#XA0;CheckLib, VerboseCheckLib</H3><P><A NAME="fun:CheckLib"></A><A NAME="@default465"></A><A NAME="@fun265"></A><A NAME="fun:VerboseCheckLib"></A><A NAME="@default466"></A><A NAME="@fun266"></A>
</P><PRE CLASS="verbatim">success = $(CheckLib &lt;libs&gt;, &lt;functions&gt;)
success = $(VerboseCheckLib &lt;libs&gt;, &lt;functions&gt;)
</PRE><P>Use the <A HREF="#fun:AC_TRY_LINK"><CODE>AC_TRY_LINK</CODE> function</A> to check whether your C compiler and linker can
find the named functions when linking with the named libraries. Will pass the <CODE>&lt;libs&gt;</CODE> to
the compiler using the <CODE>-l</CODE> flag.</P><P>Both functions return a boolean value. The <CODE>CheckLib</CODE> function is silent; the
<CODE>VerboseCheckHeader</CODE> function will use the <CODE><A HREF="#fun:AC_MSG_CHECKING">AC_MSG_CHECKING</A></CODE> and
<CODE><A HREF="#fun:AC_MSG_RESULT">AC_MSG_RESULT</A></CODE> functions to describe the test and the outcome.</P><P>Example:
</P><PRE CLASS="verbatim">static. =
    NCURSES_LIB_AVAILABLE = $(VerboseCheckLib ncurses, initscr setupterm tigetstr)
</PRE><H3 CLASS="subsection"><A NAME="htoc388">13.1.8</A>&#XA0;&#XA0;CheckProg</H3><P><A NAME="fun:CheckProg"></A><A NAME="@default467"></A><A NAME="@fun267"></A>
<CODE>success = $(CheckProg &lt;prog&gt;)</CODE></P><P>Checks whether the program <CODE>&lt;prog&gt;</CODE> exists in your path. Will use the
<CODE><A HREF="#fun:AC_MSG_CHECKING">AC_MSG_CHECKING</A></CODE> and
<CODE><A HREF="#fun:AC_MSG_RESULT">AC_MSG_RESULT</A></CODE> functions to describe the test and the outcome.</P><H2 CLASS="section"><A NAME="toc102"></A><A NAME="htoc389">13.2</A>&#XA0;&#XA0;Predefined configuration tests</H2><P>
A number of configuration tests are already included in the standard library.
In order to use them in your project, simply <CODE>open</CODE> (see Section&#XA0;<A HREF="omake-language.html#section:include">4.7</A>) the
corresponding build file in your <CODE>OMakefile</CODE> and the tests will run the first time OMake
is executed. Note that it is not a problem to <CODE>open</CODE> these files from more than one place in
your project &#X2014; if you do that, the test will still run only once.
</P><H3 CLASS="subsection"><A NAME="htoc390">13.2.1</A>&#XA0;&#XA0;NCurses library configuration</H3><P>
Add <CODE>open configure/ncurses</CODE> line to your <CODE>OMakefile</CODE> to get access to the following
autoconfiguration variables.
</P><H5 CLASS="paragraph">NCURSES_AVAILABLE</H5><P><A NAME="var:NCURSES_AVAILABLE"></A><A NAME="@default468"></A><A NAME="@var109"></A> A boolean flag that would be set when both
the <CODE>curses.h</CODE> header, the <CODE>term.h</CODE> header, and the <CODE>ncurses</CODE> library very found.</P><H5 CLASS="paragraph">NCURSES_TERMH_IN_NCURSES</H5><P><A NAME="var:NCURSES_TERMH_IN_NCURSES"></A><A NAME="@default469"></A><A NAME="@var110"></A> A boolean flag that would be set
when <CODE>term.h</CODE> has to be included as <CODE>&lt;ncurses/term.h&gt;</CODE> instead of <CODE>&lt;term.h&gt;</CODE>.
</P><H3 CLASS="subsection"><A NAME="htoc391">13.2.2</A>&#XA0;&#XA0;ReadLine library configuration</H3><P>
Add <CODE>open configure/readline</CODE> line to your <CODE>OMakefile</CODE> to get access to the following
autoconfiguration variables.
</P><H5 CLASS="paragraph">READLINE_AVAILABLE</H5><P><A NAME="var:READLINE_AVAILABLE"></A><A NAME="@default470"></A><A NAME="@var111"></A> A boolean flag that would be set when both
the <CODE>readline/readline.h</CODE> header, the <CODE>readline/history.h</CODE> header, and the <CODE>readline</CODE>
library very found.</P><H5 CLASS="paragraph">READLINE_GNU</H5><P><A NAME="var:READLINE_GNU"></A><A NAME="@default471"></A><A NAME="@var112"></A> A boolean flag that would be set
when the GNU version of the readline library is found (as opposed to the BSD one).</P><H5 CLASS="paragraph">READLINE_CFLAGS</H5><P><A NAME="var:READLINE_CFLAGS"></A><A NAME="@default472"></A><A NAME="@var113"></A> The <CODE>CFLAGS</CODE> to use when compiling readline code.
Will include <CODE>-DREADLINE_ENABLED</CODE> and <CODE>-DREADLINE_GNU</CODE>, respectively
when <CODE>READLINE_AVAILABLE</CODE> and <CODE>READLINE_GNU</CODE> are true.</P><H5 CLASS="paragraph">READLINE_CLIBS</H5><P><A NAME="var:READLINE_CLIBS"></A><A NAME="@default473"></A><A NAME="@var114"></A> The <CODE>LDFLAGS</CODE> to use when linking readline code.
Will normally contain <CODE>-lncurses -lreadline</CODE> when readline is found and remain empty otherwise.
</P><H3 CLASS="subsection"><A NAME="htoc392">13.2.3</A>&#XA0;&#XA0;Snprintf configuration</H3><P>
Add <CODE>open configure/snprintf</CODE> line to your <CODE>OMakefile</CODE> to get access to the following
autoconfiguration variables.
</P><H5 CLASS="paragraph">SNPRINTF_AVAILABLE</H5><P><A NAME="var:SNPRINTF_AVAILABLE"></A><A NAME="@default474"></A><A NAME="@var115"></A> A boolean flag telling whether the snprintf
function is available in the standard C library.</P>
<TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP>Jump to:</TD><TD VALIGN=top ALIGN=center NOWRAP>&#XA0;&#XA0;</TD><TD ALIGN=left NOWRAP><A HREF="http://omake.metaprl.org/">OMake Home</A>
&bull;&nbsp;<A HREF="omake.html">Guide Home</A>
&bull;&nbsp;<A HREF="omake-doc.html">Guide (single-page)</A>
&bull;&nbsp;<A HREF="omake-toc.html">Contents (short)</A>
&bull;&nbsp;<A HREF="omake-contents.html">Contents (long)</A></TD></TR>
<TR><TD ALIGN=left NOWRAP>Index:</TD><TD VALIGN=top ALIGN=center NOWRAP>&#XA0;&#XA0;</TD><TD ALIGN=left NOWRAP><A HREF="omake-all-index.html">All</A>
&bull;&nbsp;<A HREF="omake-var-index.html">Variables</A>
&bull;&nbsp;<A HREF="omake-fun-index.html">Functions</A>
&bull;&nbsp;<A HREF="omake-obj-index.html">Objects</A>
&bull;&nbsp;<A HREF="omake-target-index.html">Targets</A>
&bull;&nbsp;<A HREF="omake-option-index.html">Options</A></TD></TR>
</TABLE>
</BODY>
</HTML>
