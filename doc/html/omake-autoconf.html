<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.09">
<LINK rel="stylesheet" type="text/css" href="omake-doc.css">
<TITLE>Autoconfiguration functions and variables</TITLE>
</HEAD>
<BODY >

<img src="images/omake-manual.gif" border="0" align="top" alt=""><br>

<TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP>Jump to:</TD><TD VALIGN=top ALIGN=center NOWRAP>  </TD><TD ALIGN=left NOWRAP><A HREF="http://omake.metaprl.org/">OMake Home</A>
&bull;&nbsp;<A HREF="omake.html">Guide Home</A>
&bull;&nbsp;<A HREF="omake-doc.html">Guide (single-page)</A>
&bull;&nbsp;<A HREF="omake-toc.html">Contents (short)</A>
&bull;&nbsp;<A HREF="omake-contents.html">Contents (long)</A></TD></TR>
<TR><TD ALIGN=left NOWRAP>Index:</TD><TD VALIGN=top ALIGN=center NOWRAP>  </TD><TD ALIGN=left NOWRAP><A HREF="omake-all-index.html">All</A>
&bull;&nbsp;<A HREF="omake-var-index.html">Variables</A>
&bull;&nbsp;<A HREF="omake-fun-index.html">Functions</A>
&bull;&nbsp;<A HREF="omake-obj-index.html">Objects</A>
&bull;&nbsp;<A HREF="omake-target-index.html">Targets</A>
&bull;&nbsp;<A HREF="omake-option-index.html">Options</A></TD></TR>
</TABLE>
<H1 CLASS="chapter"><A NAME="htoc376">Chapter 13</A>  Autoconfiguration functions and variables</H1><UL>
<LI><A HREF="omake-autoconf.html#toc100">General-purpose autoconfiguration functions</A></LI>
<LI><A HREF="omake-autoconf.html#toc101">Predefined configuration tests</A></LI>
</UL>
<P>
<A NAME="chapter:autoconf"></A>
</P><P>
OMake standard library provides a number of functions and variables intended to help one write
build specifications that need to be capable of autoconfiguring itself to adjust to different
build environments.</P><H2 CLASS="section"><A NAME="toc100"></A><A NAME="htoc377">13.1</A>  General-purpose autoconfiguration functions</H2><P>
The following general-purpose functions can be used to discover the properties of your build
environment in a fashion similar to the one used by GNU autoconf tool you may be familiar with.
It is recommended that these function be used from an appropriate <CODE>static.</CODE> block (see
Section <A HREF="omake-language.html#section:static.">4.18</A> for more information).</P><P>In order to use the following general-purpose functions, you need to have the line
</P><PRE CLASS="verbatim">open configure/Configure
</PRE><P>included in your <CODE>OMakefile</CODE> or <CODE>OMakeroot</CODE>.
</P><H3 CLASS="subsection"><A NAME="htoc378">13.1.1</A>  AC_MSG_CHECKING, AC_MSG_RESULT</H3><P><A NAME="fun:AC_MSG_CHECKING"></A><A NAME="@default450"></A><A NAME="@fun253"></A><A NAME="fun:AC_MSG_RESULT"></A><A NAME="@default451"></A><A NAME="@fun254"></A>
</P><PRE CLASS="verbatim">AC_MSG_CHECKING(&lt;msg&gt;)
...
AC_MSG_RESULT(&lt;msg&gt;)
</PRE><P>The <CODE>AC_MSG_CHECKING</CODE> function output message of the form <CODE>--- Checking &lt;msg&gt;... </CODE>
<EM>without</EM> any trailing newline. After the test advertized by <CODE>AC_MSG_CHECKING</CODE> is
performed, the <CODE>AC_MSG_RESULT</CODE> function should be used to output the result.</P><P>In certain cases users may want to redefine these function &#X2014; for example, to use a different
output formatting and/or to copy the messages to a log file.</P><P>Example:
</P><PRE CLASS="verbatim">static. =
   AC_MSG_CHECKING(which foo to use)
   foo = ...
   AC_MSG_RESULT($(foo))
</PRE><H3 CLASS="subsection"><A NAME="htoc379">13.1.2</A>  AC_MSG_WARN</H3><P><A NAME="fun:AC_MSG_WARN"></A><A NAME="@default452"></A><A NAME="@fun255"></A>
<CODE>AC_MSG_WARN(&lt;msg&gt;)</CODE></P><P>Prints a warning message.
</P><H3 CLASS="subsection"><A NAME="htoc380">13.1.3</A>  AC_MSG_YES_NO, AC_MSG_FOUND</H3><P><A NAME="fun:AC_MSG_YES_NO"></A><A NAME="@default453"></A><A NAME="@fun256"></A><A NAME="fun:AC_MSG_FOUND"></A><A NAME="@default454"></A><A NAME="@fun257"></A>
</P><PRE CLASS="verbatim">flag = $(AC_MSG_YES_NO &lt;bool expr&gt;
flag = $(AC_MSG_FOUND &lt;bool expr&gt;
</PRE><P>The <CODE>AC_MSG_FOUND</CODE> function expects to receive a boolean flag describing whether a test
previously announced using the <A HREF="#fun:AC_MSG_CHECKING"><CODE>AC_MSG_CHECKING</CODE> function</A> found what it
was looking for. <CODE>AC_MSG_FOUND</CODE> will output the appropriate result (&#X201C;found&#X201D; or &#X201C;NOT found&#X201D;)
using the <A HREF="#fun:AC_MSG_RESULT"><CODE>AC_MSG_RESULT</CODE> function</A> and return its argument back.</P><P>The <CODE>AC_MSG_YES_NO</CODE> function is similar, outputting a simple (&#X201C;yes&#X201D; or &#X201C;NO&#X201D;).
</P><H3 CLASS="subsection"><A NAME="htoc381">13.1.4</A>  CheckHeader, VerboseCheckHeader</H3><P><A NAME="fun:CheckHeader"></A><A NAME="@default455"></A><A NAME="@fun258"></A><A NAME="fun:VerboseCheckHeader"></A><A NAME="@default456"></A><A NAME="@fun259"></A>
</P><PRE CLASS="verbatim">success = $(CheckHeader &lt;files&gt;)
success = $(VerboseCheckHeader &lt;files&gt;)
</PRE><P>Check whether your C compiler can locate and process the specified headers files.
Will use the <A HREF="omake-build.html#var:CC"><CODE>CC</CODE></A>, <A HREF="omake-build.html#var:CFLAGS"><CODE>CFLAGS</CODE></A> and <A HREF="omake-build.html#var:INCLUDES"><CODE>INCLUDES</CODE></A> variables 
to run the compiler. Will incude <CODE>&lt;stdio.h&gt;</CODE> before including the specified header files.</P><P>Both functions return a boolean value. The <CODE>CheckHeader</CODE> function is silent; the
<CODE>VerboseCheckHeader</CODE> function will use the <A HREF="#fun:AC_MSG_CHECKING"><CODE>AC_MSG_CHECKING</CODE></A> and
<A HREF="#fun:AC_MSG_RESULT"><CODE>AC_MSG_RESULT</CODE></A> functions to describe the test and the outcome.</P><P>Example:
</P><PRE CLASS="verbatim">static. =
   NCURSES_H_AVAILABLE = $(VerboseCheckHeader ncurses.h)
</PRE><H3 CLASS="subsection"><A NAME="htoc382">13.1.5</A>  CheckLib, VerboseCheckLib</H3><P><A NAME="fun:CheckLib"></A><A NAME="@default457"></A><A NAME="@fun260"></A><A NAME="fun:VerboseCheckLib"></A><A NAME="@default458"></A><A NAME="@fun261"></A>
</P><PRE CLASS="verbatim">success = $(CheckLib &lt;libs&gt;, &lt;functions&gt;)
success = $(VerboseCheckLib &lt;libs&gt;, &lt;functions&gt;)
</PRE><P>Check whether your C compiler and linker can find the named functions when linking with
the named libraries.
Will use the <A HREF="omake-build.html#var:CC"><CODE>CC</CODE></A>, <A HREF="omake-build.html#var:CFLAGS"><CODE>CFLAGS</CODE></A> and <A HREF="omake-build.html#var:LDFLAGS"><CODE>LDFLAGS</CODE></A> variables 
to run the compiler. Will pass the <CODE>&lt;libs&gt;</CODE> to the compiler using the <CODE>-l</CODE> flag.</P><P>Both functions return a boolean value. The <CODE>CheckLib</CODE> function is silent; the
<CODE>VerboseCheckHeader</CODE> function will use the <A HREF="#fun:AC_MSG_CHECKING"><CODE>AC_MSG_CHECKING</CODE></A> and
<A HREF="#fun:AC_MSG_RESULT"><CODE>AC_MSG_RESULT</CODE></A> functions to describe the test and the outcome.</P><P>Example:
</P><PRE CLASS="verbatim">static. =
    NCURSES_LIB_AVAILABLE = $(VerboseCheckLib ncurses, initscr setupterm tigetstr)
</PRE><H3 CLASS="subsection"><A NAME="htoc383">13.1.6</A>  CheckProg</H3><P><A NAME="fun:CheckProg"></A><A NAME="@default459"></A><A NAME="@fun262"></A>
<CODE>success = $(CheckProg &lt;prog&gt;)</CODE></P><P>Checks whether the program <CODE>&lt;prog&gt;</CODE> exists in your path. Will use the
<A HREF="#fun:AC_MSG_CHECKING"><CODE>AC_MSG_CHECKING</CODE></A> and
<A HREF="#fun:AC_MSG_RESULT"><CODE>AC_MSG_RESULT</CODE></A> functions to describe the test and the outcome.</P><H2 CLASS="section"><A NAME="toc101"></A><A NAME="htoc384">13.2</A>  Predefined configuration tests</H2><P>
A number of configuration tests are already included in the standard library.
In order to use them in your project, simply <CODE>open</CODE> (see Section <A HREF="omake-language.html#section:include">4.7</A>) the
corresponding build file in your <CODE>OMakefile</CODE> and the tests will run the first time OMake
is executed. Note that it is not a problem to <CODE>open</CODE> these files from more than one place in
your project &#X2014; if you do that, the test will still run only once.
</P><H3 CLASS="subsection"><A NAME="htoc385">13.2.1</A>  NCurses library configuration</H3><P>
Add <CODE>open configure/ncurses</CODE> line to your <CODE>OMakefile</CODE> to get access to the following
autoconfiguration variables.
</P><H5 CLASS="paragraph">NCURSES_AVAILABLE</H5><P><A NAME="var:NCURSES_AVAILABLE"></A><A NAME="@default460"></A><A NAME="@var109"></A> A boolean flag that would be set when both
the <CODE>curses.h</CODE> header, the <CODE>term.h</CODE> header, and the <CODE>ncurses</CODE> library very found.</P><H5 CLASS="paragraph">NCURSES_TERMH_IN_NCURSES</H5><P><A NAME="var:NCURSES_TERMH_IN_NCURSES"></A><A NAME="@default461"></A><A NAME="@var110"></A> A boolean flag that would be set
when <CODE>term.h</CODE> has to be included as <CODE>&lt;ncurses/term.h&gt;</CODE> instead of <CODE>&lt;term.h&gt;</CODE>.
</P><H3 CLASS="subsection"><A NAME="htoc386">13.2.2</A>  ReadLine library configuration</H3><P>
Add <CODE>open configure/readline</CODE> line to your <CODE>OMakefile</CODE> to get access to the following
autoconfiguration variables.
</P><H5 CLASS="paragraph">READLINE_AVAILABLE</H5><P><A NAME="var:READLINE_AVAILABLE"></A><A NAME="@default462"></A><A NAME="@var111"></A> A boolean flag that would be set when both
the <CODE>readline/readline.h</CODE> header, the <CODE>readline/history.h</CODE> header, and the <CODE>readline</CODE>
library very found.</P><H5 CLASS="paragraph">READLINE_GNU</H5><P><A NAME="var:READLINE_GNU"></A><A NAME="@default463"></A><A NAME="@var112"></A> A boolean flag that would be set
when the GNU version of the readline library is found (as opposed to the BSD one).</P><H5 CLASS="paragraph">READLINE_CFLAGS</H5><P><A NAME="var:READLINE_CFLAGS"></A><A NAME="@default464"></A><A NAME="@var113"></A> The <CODE>CFLAGS</CODE> to use when compiling readline code.
Will include <CODE>-DREADLINE_ENABLED</CODE> and <CODE>-DREADLINE_GNU</CODE>, respectively
when <CODE>READLINE_AVAILABLE</CODE> and <CODE>READLINE_GNU</CODE> are true.</P><H5 CLASS="paragraph">READLINE_CLIBS</H5><P><A NAME="var:READLINE_CLIBS"></A><A NAME="@default465"></A><A NAME="@var114"></A> The <CODE>LDFLAGS</CODE> to use when linking readline code.
Will normally contain <CODE>-lncurses -lreadline</CODE> when readline is found and remain empty otherwise.
</P><H3 CLASS="subsection"><A NAME="htoc387">13.2.3</A>  Snprintf configuration</H3><P>
Add <CODE>open configure/snprintf</CODE> line to your <CODE>OMakefile</CODE> to get access to the following
autoconfiguration variables.
</P><H5 CLASS="paragraph">SNPRINTF_AVAILABLE</H5><P><A NAME="var:SNPRINTF_AVAILABLE"></A><A NAME="@default466"></A><A NAME="@var115"></A> A boolean flag telling whether the snprintf
function is available in the standard C library.</P>
<TABLE CELLSPACING=6 CELLPADDING=0><TR><TD ALIGN=left NOWRAP>Jump to:</TD><TD VALIGN=top ALIGN=center NOWRAP>  </TD><TD ALIGN=left NOWRAP><A HREF="http://omake.metaprl.org/">OMake Home</A>
&bull;&nbsp;<A HREF="omake.html">Guide Home</A>
&bull;&nbsp;<A HREF="omake-doc.html">Guide (single-page)</A>
&bull;&nbsp;<A HREF="omake-toc.html">Contents (short)</A>
&bull;&nbsp;<A HREF="omake-contents.html">Contents (long)</A></TD></TR>
<TR><TD ALIGN=left NOWRAP>Index:</TD><TD VALIGN=top ALIGN=center NOWRAP>  </TD><TD ALIGN=left NOWRAP><A HREF="omake-all-index.html">All</A>
&bull;&nbsp;<A HREF="omake-var-index.html">Variables</A>
&bull;&nbsp;<A HREF="omake-fun-index.html">Functions</A>
&bull;&nbsp;<A HREF="omake-obj-index.html">Objects</A>
&bull;&nbsp;<A HREF="omake-target-index.html">Targets</A>
&bull;&nbsp;<A HREF="omake-option-index.html">Options</A></TD></TR>
</TABLE>
</BODY>
</HTML>
