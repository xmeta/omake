<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>



<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.08">
<LINK rel="stylesheet" type="text/css" href="omake-doc.css">
<TITLE>
Build functions
</TITLE>
</HEAD>
<BODY >

<img src="images/omake-manual.gif" border="0" align="top"><br>

<TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP>Jump to:</TD>
<TD VALIGN=top ALIGN=center NOWRAP>&nbsp;&nbsp;</TD>
<TD ALIGN=left NOWRAP><A HREF="http://omake.metaprl.org/">OMake Home</A>
&bull;&nbsp;<A HREF="omake.html">Guide Home</A>
&bull;&nbsp;<A HREF="omake-doc.html">Guide (single-page)</A>
&bull;&nbsp;<A HREF="omake-toc.html">Contents (short)</A>
&bull;&nbsp;<A HREF="omake-contents.html">Contents (long)</A></TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Index:</TD>
<TD VALIGN=top ALIGN=center NOWRAP>&nbsp;&nbsp;</TD>
<TD ALIGN=left NOWRAP><A HREF="omake-all-index.html">All</A>
&bull;&nbsp;<A HREF="omake-var-index.html">Variables</A>
&bull;&nbsp;<A HREF="omake-fun-index.html">Functions</A>
&bull;&nbsp;<A HREF="omake-obj-index.html">Objects</A>
&bull;&nbsp;<A HREF="omake-target-index.html">Targets</A>
&bull;&nbsp;<A HREF="omake-option-index.html">Options</A></TD>
</TR></TABLE>

<H1 CLASS="chapter"><A NAME="htoc323">Chapter&nbsp;12</A>&nbsp;&nbsp;Build functions</H1><UL>
<LI><A HREF="omake-rule.html#toc86">Builtin .PHONY targets</A>
<LI><A HREF="omake-rule.html#toc87">Options and versioning</A>
<LI><A HREF="omake-rule.html#toc88">The OMakeroot file</A>
<LI><A HREF="omake-rule.html#toc89">Building C programs</A>
<LI><A HREF="omake-rule.html#toc90">Building OCaml programs</A>
<LI><A HREF="omake-rule.html#toc91">Generated OCaml Files</A>
<LI><A HREF="omake-rule.html#toc92">Building L<sup>A</sup>T<sub>E</sub>X programs</A>
<LI><A HREF="omake-rule.html#toc93">Examining the dependency graph</A>
</UL>

<A NAME="chapter:rule"></A>

<A NAME="toc86"></A>
<H2 CLASS="section"><A NAME="htoc324">12.1</A>&nbsp;&nbsp;Builtin .PHONY targets</H2>
The complete set of builtin <CODE>.PHONY</CODE> targets include the following.
<DL CLASS="description" COMPACT=compact><DT CLASS="dt-description">
<B>.PHONY</B><DD CLASS="dd-description"> Declares new phony targets (Section&nbsp;<A HREF="omake-rules.html#target:.PHONY">7.12</A>).
<DT CLASS="dt-description"><B>.DEFAULT</B><DD CLASS="dd-description"> Declare the default build targets (Section&nbsp;<A HREF="omake-rules.html#target:.DEFAULT">7.9</A>).
<DT CLASS="dt-description"><B>.SUBDIRS</B><DD CLASS="dd-description"> Include a directory as part of the project (Section&nbsp;<A HREF="omake-rules.html#target:.SUBDIRS">7.10</A>).
<DT CLASS="dt-description"><B>.SCANNER</B><DD CLASS="dd-description"> Define a dependency scanner (Section&nbsp;<A HREF="omake-rules.html#target:.SUBDIRS">7.10</A>).
<DT CLASS="dt-description"><B>.INCLUDE</B><DD CLASS="dd-description"> Include a file (Section&nbsp;<A HREF="omake-rules.html#target:.INCLUDE">7.11</A>).
<DT CLASS="dt-description"><B>.ORDER</B><DD CLASS="dd-description"> Define a file-dependency ordering rule (Section&nbsp;<A HREF="omake-system.html#target:.ORDER">9.3.5</A>).
<DT CLASS="dt-description"><B>.BUILD_BEGIN</B><DD CLASS="dd-description"> Commands to be executed at the beginning of a build.
<DT CLASS="dt-description"><B>.BUILD_SUCCESS</B><DD CLASS="dd-description"> Commands to be executed if the build is successful.
<DT CLASS="dt-description"><B>.BUILD_FAILURE</B><DD CLASS="dd-description"> Commands to be executed if the build fails.
</DL>
<A NAME="@default286"></A><A NAME="@target9"></A><A NAME="target:.BUILD_BEGIN"></A>
<A NAME="@default287"></A><A NAME="@target10"></A><A NAME="target:.BUILD_SUCCESS"></A>
<A NAME="@default288"></A><A NAME="@target11"></A><A NAME="target:.BUILD_FAILURE"></A>
The <CODE>.BUILD</CODE> targets can be used to specify commands to be executed at
the beginning and end of the build. The <CODE>.BUILD_BEGIN</CODE> target is built
at the beginning of a project build, and one of <CODE>.BUILD_FAILURE</CODE> or
<CODE>.BUILD_SUCCESS</CODE> is executed when the build terminates.<BR>
<BR>
For example, the following set of rules simply print additional messages
about the status of the build.
<PRE CLASS="verbatim">
   .BUILD_BEGIN:
       echo Build starting

   .BUILD_SUCCESS:
       echo The build was successful

   .BUILD_FAILURE:
       println($"The build failed: $(length $(find-build-targets Failed)) targets could not be built")
</PRE>
Another common use is to define notifications to be performed when
the build completes. For example, the following rule will create
a new X terminal displaying the summary of the build
(see <CODE>BUILD_SUMMARY</CODE>&nbsp;<A HREF="omake-base.html#var:BUILD_SUMMARY">8.1.12</A>).
<PRE CLASS="verbatim">
    .BUILD_FAILURE:
        xterm -e vi $(BUILD_SUMMARY)
</PRE>
If you do not wish to add these rules directly to your project (which
is probably a good idea if you work with others), you can
define them in your <CODE>.omakerc</CODE>&nbsp;<A HREF="omake-options.html#section:.omakerc">A.8</A>.<BR>
<BR>
The <CODE>find-build-targets</CODE> function&nbsp;<A HREF="#fun:find-build-targets">12.8.0.9</A>
is useful for obtaining a firther summary of the build. Note that
when output diversions are in effect (with the <CODE>--divert-*</CODE> options&nbsp;<A HREF="omake-options.html#chapter:options">A</A>),
any output produced by the commands is copied to a file. The name of the
file is specified by the <CODE>output-file</CODE> field of the <CODE>Target</CODE>&nbsp;<A HREF="omake-pervasives.html#obj:Target">11.1.11</A> object.
You may find this useful in defining custom build summaries.
<A NAME="toc87"></A>
<H2 CLASS="section"><A NAME="htoc325">12.2</A>&nbsp;&nbsp;Options and versioning</H2>

<H4 CLASS="subsubsection"><A NAME="htoc326">12.2.0.1</A>&nbsp;&nbsp;OMakeFlags</H4><A NAME="@default289"></A><A NAME="@fun200"></A><A NAME="fun:OMakeFlags"></A>
<PRE CLASS="verbatim">
   OMakeFlags(options)
      options : String
</PRE>
The <CODE>OMakeFlags</CODE> function is used to set <CODE>omake</CODE> options from
within <TT>OMakefile</TT>s. The options have exactly the same format as
options on the command line.<BR>
<BR>
For example, the following code displays the progress bar unless
the <CODE>VERBOSE</CODE> environment variable is defined.
<PRE CLASS="verbatim">
    if $(not $(defined-env VERBOSE))
        OMakeFlags(-S --progress)
        export
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc327">12.2.0.2</A>&nbsp;&nbsp;OMakeVersion</H4><A NAME="@default290"></A><A NAME="@fun201"></A><A NAME="fun:OMakeVersion"></A>
<PRE CLASS="verbatim">
   OMakeVersion(version1)
   OMakeVersion(version1, version2)
      version1, version2 : String
</PRE>
The <CODE>OMakeVersion</CODE> function is used for version checking
in <TT>OMakefile</TT>s. It takes one or two arguments.<BR>
<BR>
In the one argument form, if the <TT>omake</TT> version number
is less than <CODE>&lt;version1&gt;</CODE>,
then an exception is raised. In the two argument form,
the version must lie between <CODE>version1</CODE> and <CODE>version2</CODE>.<BR>
<BR>

<H4 CLASS="subsubsection"><A NAME="htoc328">12.2.0.3</A>&nbsp;&nbsp;cmp-versions</H4><A NAME="@default291"></A><A NAME="@fun202"></A><A NAME="fun:cmp-versions"></A>
<PRE CLASS="verbatim">
   $(cmp-versions version1, version2)
      version1, version2 : String
</PRE>
The <CODE>cmp-versions\</CODE> functions can be used to compare arbitrary version strings.
It returns 0 when the two version strings are equal, a negative number when the first
string represents an earlier version, and a positive number otherwise.

<H4 CLASS="subsubsection"><A NAME="htoc329">12.2.0.4</A>&nbsp;&nbsp;DefineCommandVars</H4><A NAME="@default292"></A><A NAME="@fun203"></A><A NAME="fun:DefineCommandVars"></A>
<PRE CLASS="verbatim">
   DefineCommandVars()
</PRE>
The <CODE>DefineCommandVars</CODE> function redefines the variables passed on
the commandline. Variables definitions are passed on the command line
in the form <CODE>name=value</CODE>. This function is primarily for internal
use by <TT>omake</TT> to define these variables for the first time.
<A NAME="toc88"></A>
<H2 CLASS="section"><A NAME="htoc330">12.3</A>&nbsp;&nbsp;The OMakeroot file</H2>
<A NAME="@default293"></A>
The standard <TT>OMakeroot</TT> file defines the functions are rules
for building standard projects.<BR>
<BR>

<H3 CLASS="subsection"><A NAME="htoc331">12.3.1</A>&nbsp;&nbsp;Variables</H3>

<H4 CLASS="subsubsection"><A NAME="htoc332">12.3.1.1</A>&nbsp;&nbsp;ROOT</H4><A NAME="@default294"></A><A NAME="@var15"></A><A NAME="var:ROOT"></A> The root directory of the current project.

<H4 CLASS="subsubsection"><A NAME="htoc333">12.3.1.2</A>&nbsp;&nbsp;CWD</H4><A NAME="@default295"></A><A NAME="@var16"></A><A NAME="var:CWD"></A> The current working directory (the directory is set for each <TT>OMakefile</TT> in the project).

<H4 CLASS="subsubsection"><A NAME="htoc334">12.3.1.3</A>&nbsp;&nbsp;EMPTY</H4><A NAME="@default296"></A><A NAME="@var17"></A><A NAME="var:EMPTY"></A> The empty string.

<H4 CLASS="subsubsection"><A NAME="htoc335">12.3.1.4</A>&nbsp;&nbsp;STDROOT</H4><A NAME="@default297"></A><A NAME="@var18"></A><A NAME="var:STDROOT"></A> The name of the standard installed <TT>OMakeroot</TT> file.

<H4 CLASS="subsubsection"><A NAME="htoc336">12.3.1.5</A>&nbsp;&nbsp;VERBOSE</H4><A NAME="@default298"></A><A NAME="@var19"></A><A NAME="var:VERBOSE"></A> Whether certain commands should be verbose (<CODE>false</CODE> by default).

<H4 CLASS="subsubsection"><A NAME="htoc337">12.3.1.6</A>&nbsp;&nbsp;ABORT_ON_COMMAND_ERROR</H4><A NAME="@default299"></A><A NAME="@var20"></A><A NAME="var:ABORT_ON_COMMAND_ERROR"></A> If set to true, the construction of a target should
 be aborted whenever one of the commands to build it fail. This defaults to true,
 and should normally be left that way.<BR>
<BR>

<H4 CLASS="subsubsection"><A NAME="htoc338">12.3.1.7</A>&nbsp;&nbsp;SCANNER_MODE</H4><A NAME="@default300"></A><A NAME="@var21"></A><A NAME="var:SCANNER_MODE"></A> This variable should be defined as one of four values
 (defaults to <CODE>enabled</CODE>).
<DL CLASS="description" COMPACT=compact><DT CLASS="dt-description">
<B>enabled</B><DD CLASS="dd-description"> Allow the use of default <CODE>.SCANNER</CODE> rules. Whenever a rule does
 not specify a <CODE>:scanner:</CODE> dependency explicitly, try to find a
 <CODE>.SCANNER</CODE> with the same target name.
<DT CLASS="dt-description"><B>disabled</B><DD CLASS="dd-description"> Never use default <CODE>.SCANNER</CODE> rules.
<DT CLASS="dt-description"><B>warning</B><DD CLASS="dd-description"> Allow the use of default <CODE>.SCANNER</CODE> rules, but print a warning
 whenever one is selected.
<DT CLASS="dt-description"><B>error</B><DD CLASS="dd-description"> Do not allow the use of default <CODE>.SCANNER</CODE> rules. If a rule
 does not specify a <CODE>:scanner:</CODE> dependency, and there is a default
 <CODE>.SCANNER</CODE> rule, the build will terminate abnormally.
</DL>

<H3 CLASS="subsection"><A NAME="htoc339">12.3.2</A>&nbsp;&nbsp;System variables</H3>

<H4 CLASS="subsubsection"><A NAME="htoc340">12.3.2.1</A>&nbsp;&nbsp;INSTALL</H4><A NAME="@default301"></A><A NAME="@var22"></A><A NAME="var:INSTALL"></A> The command to install a program (<CODE>install</CODE> on <CODE>Unix</CODE>, <CODE>cp</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc341">12.3.2.2</A>&nbsp;&nbsp;PATHSEP</H4><A NAME="@default302"></A><A NAME="@var23"></A><A NAME="var:PATHSEP"></A> The normal path separator (<CODE>:</CODE> on <CODE>Unix</CODE>, <CODE>;</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc342">12.3.2.3</A>&nbsp;&nbsp;DIRSEP</H4><A NAME="@default303"></A><A NAME="@var24"></A><A NAME="var:DIRSEP"></A> The normal directory separator (<CODE>/</CODE> on <CODE>Unix</CODE>, <CODE>\</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc343">12.3.2.4</A>&nbsp;&nbsp;EXT_LIB</H4><A NAME="@default304"></A><A NAME="@var25"></A><A NAME="var:EXT_LIB"></A> File suffix for a static library (default is <CODE>.a</CODE> on <CODE>Unix</CODE>, and <CODE>.lib</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc344">12.3.2.5</A>&nbsp;&nbsp;EXT_OBJ</H4><A NAME="@default305"></A><A NAME="@var26"></A><A NAME="var:EXT_OBJ"></A> File suffix for an object file (default is <CODE>.o</CODE> on <CODE>Unix</CODE>, and <CODE>.obj</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc345">12.3.2.6</A>&nbsp;&nbsp;EXT_ASM</H4><A NAME="@default306"></A><A NAME="@var27"></A><A NAME="var:EXT_ASM"></A> File suffix for an assembly file (default is <CODE>.s</CODE> on <CODE>Unix</CODE>, and <CODE>.asm</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc346">12.3.2.7</A>&nbsp;&nbsp;EXE</H4><A NAME="@default307"></A><A NAME="@var28"></A><A NAME="var:EXE"></A> File suffix for executables (default is empty for <CODE>Unix</CODE>, and <CODE>.exe</CODE> on <CODE>Win32</CODE> and <CODE>Cygwin</CODE>).
<A NAME="toc89"></A>
<H2 CLASS="section"><A NAME="htoc347">12.4</A>&nbsp;&nbsp;Building C programs</H2>
<TT>omake</TT> provides extensive support for building C programs.<BR>
<BR>

<H3 CLASS="subsection"><A NAME="htoc348">12.4.1</A>&nbsp;&nbsp;C configuration variables</H3>
The following variables can be redefined in your project.<BR>
<BR>

<H4 CLASS="subsubsection"><A NAME="htoc349">12.4.1.1</A>&nbsp;&nbsp;CC</H4><A NAME="@default308"></A><A NAME="@var29"></A><A NAME="var:CC"></A> The name of the C compiler (on <CODE>Unix</CODE> it defaults to <CODE>gcc</CODE> when <CODE>gcc</CODE> is present and
 to <CODE>cc</CODE> otherwise; on <CODE>Win32</CODE> defaults to <CODE>cl /nologo</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc350">12.4.1.2</A>&nbsp;&nbsp;CXX</H4><A NAME="@default309"></A><A NAME="@var30"></A><A NAME="var:CXX"></A> The name of the C++ compiler (on <CODE>Unix</CODE> it defaults to <CODE>gcc</CODE> when <CODE>gcc</CODE> is present
 and to <CODE>c</CODE>++ otherwise; on <CODE>Win32</CODE> defaults to <CODE>cl /nologo</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc351">12.4.1.3</A>&nbsp;&nbsp;CPP</H4><A NAME="@default310"></A><A NAME="@var31"></A><A NAME="var:CPP"></A> The name of the C preprocessor (defaults to <CODE>cpp</CODE> on <CODE>Unix</CODE>, and <CODE>cl /E</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc352">12.4.1.4</A>&nbsp;&nbsp;CFLAGS</H4><A NAME="@default311"></A><A NAME="@var32"></A><A NAME="var:CFLAGS"></A> Compilation flags to pass to the C compiler (default empty on <CODE>Unix</CODE>, and <CODE>/DWIN32</CODE>
 on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc353">12.4.1.5</A>&nbsp;&nbsp;CXXFLAGS</H4><A NAME="@default312"></A><A NAME="@var33"></A><A NAME="var:CXXFLAGS"></A> Compilation flags to pass to the C++ compiler (default empty on <CODE>Unix</CODE>, and <CODE>/DWIN32</CODE>
 on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc354">12.4.1.6</A>&nbsp;&nbsp;INCLUDES</H4><A NAME="@default313"></A><A NAME="@var34"></A><A NAME="var:INCLUDES"></A> Additional directories that specify the search path to the C and C++ compilers (default is <CODE>.</CODE>).
 The directories are passed to the C and C++ compilers with the <CODE>-I</CODE> option.
 The include path with <CODE>-I</CODE> prefixes is defined in the <CODE>PREFIXED_INCLUDES</CODE> variable.

<H4 CLASS="subsubsection"><A NAME="htoc355">12.4.1.7</A>&nbsp;&nbsp;LIBS</H4><A NAME="@default314"></A><A NAME="@var35"></A><A NAME="var:LIBS"></A> Additional libraries needed when building a program (default is empty).

<H4 CLASS="subsubsection"><A NAME="htoc356">12.4.1.8</A>&nbsp;&nbsp;AS</H4><A NAME="@default315"></A><A NAME="@var36"></A><A NAME="var:AS"></A> The name of the assembler (defaults to <CODE>as</CODE> on <CODE>Unix</CODE>, and <CODE>ml</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc357">12.4.1.9</A>&nbsp;&nbsp;ASFLAGS</H4><A NAME="@default316"></A><A NAME="@var37"></A><A NAME="var:ASFLAGS"></A> Flags to pass to the assembler (default is empty on <CODE>Unix</CODE>, and <CODE>/c /coff</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc358">12.4.1.10</A>&nbsp;&nbsp;AR</H4><A NAME="@default317"></A><A NAME="@var38"></A><A NAME="var:AR"></A> The name of the program to create static libraries (defaults to <CODE>ar cq</CODE> on <CODE>Unix</CODE>,
 and <CODE>lib</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc359">12.4.1.11</A>&nbsp;&nbsp;AROUT</H4><A NAME="@default318"></A><A NAME="@var39"></A><A NAME="var:AROUT"></A> The option string that specifies the output file for <CODE>AR</CODE>.

<H4 CLASS="subsubsection"><A NAME="htoc360">12.4.1.12</A>&nbsp;&nbsp;LD</H4><A NAME="@default319"></A><A NAME="@var40"></A><A NAME="var:LD"></A> The name of the linker (defaults to <CODE>ld</CODE> on <CODE>Unix</CODE>, and <CODE>cl</CODE> on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc361">12.4.1.13</A>&nbsp;&nbsp;LDFLAGS</H4><A NAME="@default320"></A><A NAME="@var41"></A><A NAME="var:LDFLAGS"></A> Options to pass to the linker (default is empty).

<H4 CLASS="subsubsection"><A NAME="htoc362">12.4.1.14</A>&nbsp;&nbsp;YACC</H4><A NAME="@default321"></A><A NAME="@var42"></A><A NAME="var:YACC"></A> The name of the <CODE>yacc</CODE> parser generator (default is <CODE>yacc</CODE> on <CODE>Unix</CODE>, empty on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc363">12.4.1.15</A>&nbsp;&nbsp;LEX</H4><A NAME="@default322"></A><A NAME="@var43"></A><A NAME="var:LEX"></A> The name of the <CODE>lex</CODE> lexer generator (default is <CODE>lex</CODE> on <CODE>Unix</CODE>, empty on <CODE>Win32</CODE>).

<H3 CLASS="subsection"><A NAME="htoc364">12.4.2</A>&nbsp;&nbsp;Generated C files</H3>
Because the C scanners do not normally know anything about generated source files (such as
generated header files), these files may need to be created before running the scanner.

<H4 CLASS="subsubsection"><A NAME="htoc365">12.4.2.1</A>&nbsp;&nbsp;CGeneratedFiles, LocalCGeneratedFiles</H4><A NAME="@default323"></A><A NAME="@fun204"></A><A NAME="fun:CGeneratedFiles"></A><A NAME="@default324"></A><A NAME="@fun205"></A><A NAME="fun:LocalCGeneratedFiles"></A>
<PRE CLASS="verbatim">
CGeneratedFiles(files)
LocalCGeneratedFiles(files)
</PRE>
The <CODE>CGeneratedFiles</CODE> and <CODE>LocalCGeneratedFiles</CODE> functions specify files
that need to be generated before any C files are scanned for dependencies. For example,
if <CODE>config.h</CODE> and <CODE>inputs.h</CODE> are both generated files, specify:
<PRE CLASS="verbatim">
CGeneratedFiles(config.h inputs.h)
</PRE>
The <CODE>CGeneratedFiles</CODE> function is <EM>global</EM> &mdash; its arguments will be generated
before any C files anywhere in the project are scanned for dependencies. The
<CODE>LocalCGeneratedFiles</CODE> function follows the normal scoping rules of OMake.<BR>
<BR>

<H3 CLASS="subsection"><A NAME="htoc366">12.4.3</A>&nbsp;&nbsp;Building C programs and Libraries</H3>

<H4 CLASS="subsubsection"><A NAME="htoc367">12.4.3.1</A>&nbsp;&nbsp;StaticCLibrary</H4><A NAME="@default325"></A><A NAME="@fun206"></A><A NAME="fun:StaticCLibrary"></A>
The <CODE>StaticCLibrary</CODE> builds a static library.<BR>
<BR>
<CODE>StaticCLibrary(&lt;target&gt;, &lt;files&gt;)</CODE><BR>
<BR>
The <CODE>&lt;target&gt;</CODE> does <EM>not</EM> include the library suffix, and
The <CODE>&lt;files&gt;</CODE> list does not include the object suffix. These
are obtained from the <CODE>EXT_LIB</CODE> and <CODE>EXT_OBJ</CODE> variables.<BR>
<BR>
This function returns the library filename.<BR>
<BR>
The following command builds the library <CODE>libfoo.a</CODE> from the
files <CODE>a.o b.o c.o</CODE> on <CODE>Unix</CODE>, or the library
<CODE>libfoo.lib</CODE> from the files <CODE>a.obj b.obj c.obj</CODE>
on <CODE>Win32</CODE>.
<PRE CLASS="verbatim">
StaticCLibrary(libfoo, a b c)
.DEFAULT: $(StaticCLibrary libbar, a b c d)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc368">12.4.3.2</A>&nbsp;&nbsp;StaticCLibraryCopy</H4><A NAME="@default326"></A><A NAME="@fun207"></A><A NAME="fun:StaticCLibraryCopy"></A>
The <CODE>StaticCLibraryCopy</CODE> function copies the static library
to an install location.<BR>
<BR>
<CODE>StaticCLibraryCopy(&lt;tag&gt;, &lt;dir&gt;, &lt;lib&gt;)</CODE><BR>
<BR>
The <CODE>&lt;tag&gt;</CODE> is the name of a target (typically a <CODE>.PHONY</CODE> target);
the <CODE>&lt;dir&gt;</CODE> is the installation directory, and <CODE>&lt;lib&gt;</CODE> is
the library to be copied (without the library suffix).<BR>
<BR>
This function returns the filename of the library in the target directory.<BR>
<BR>
For example, the following code copies the library
<CODE>libfoo.a</CODE> to the <CODE>/usr/lib</CODE> directory.
<PRE CLASS="verbatim">
.PHONY: install

StaticCLibraryCopy(install, /usr/lib, libfoo)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc369">12.4.3.3</A>&nbsp;&nbsp;StaticCLibraryInstall</H4><A NAME="@default327"></A><A NAME="@fun208"></A><A NAME="fun:StaticCLibraryInstall"></A>
The <CODE>StaticCLibraryInstall</CODE> function builds a library, and
sets the install location in one step. It returns the filename of the library
in the target directory.<BR>
<BR>
<CODE>StaticCLibraryInstall(&lt;tag&gt;, &lt;dir&gt;, &lt;libname&gt;, &lt;files&gt;)</CODE>
<PRE CLASS="verbatim">
StaticCLibraryInstall(install, /usr/lib, libfoo, a b c)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc370">12.4.3.4</A>&nbsp;&nbsp;StaticCObject, StaticCObjectCopy, StaticCObjectInstall</H4><A NAME="@default328"></A><A NAME="@fun209"></A><A NAME="fun:StaticCObject"></A><A NAME="@default329"></A><A NAME="@fun210"></A><A NAME="fun:StaticCObjectCopy"></A><A NAME="@default330"></A><A NAME="@fun211"></A><A NAME="fun:StaticCObjectInstall"></A>
These functions mirror the <CODE>StaticCLibrary</CODE>, <CODE>StaticCLibraryCopy</CODE>,
and <CODE>StaticCLibraryInstall</CODE> functions, but they build an <EM>object</EM>
file (a <CODE>.o</CODE> file on <CODE>Unix</CODE>, and a <CODE>.obj</CODE> file on <CODE>Win32</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc371">12.4.3.5</A>&nbsp;&nbsp;CProgram</H4><A NAME="@default331"></A><A NAME="@fun212"></A><A NAME="fun:CProgram"></A>
The <CODE>CProgram</CODE> function builds a C program from a set
of object files and libraries.<BR>
<BR>
<CODE>CProgram(&lt;name&gt;, &lt;files&gt;)</CODE><BR>
<BR>
The <CODE>&lt;name&gt;</CODE> argument specifies the name of the program to be built;
the <CODE>&lt;files&gt;</CODE> argument specifies the files to be linked. The function
returns the filename of the executable.<BR>
<BR>
Additional options can be passed through the following variables.
<DL CLASS="description" COMPACT=compact><DT CLASS="dt-description">
<B>CFLAGS</B><DD CLASS="dd-description"> Flags used by the C compiler during the link step.
<DT CLASS="dt-description"><B>LDFLAGS</B><DD CLASS="dd-description"> Flags to pass to the loader.
<DT CLASS="dt-description"><B>LIBS</B><DD CLASS="dd-description"> Additional libraries to be linked.
</DL>
For example, the following code specifies that the program
<CODE>foo</CODE> is to be produced by linking the files <CODE>bar.o</CODE>
and <CODE>baz.o</CODE> and libraries <CODE>libfoo.a</CODE>.
<PRE CLASS="verbatim">
section
   LIBS = libfoo
   LDFLAGS += -lbar
   CProgram(foo, bar baz)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc372">12.4.3.6</A>&nbsp;&nbsp;CProgramCopy</H4><A NAME="@default332"></A><A NAME="@fun213"></A><A NAME="fun:CProgramCopy"></A>
The <CODE>CProgramCopy</CODE> function copies a file to an install location.<BR>
<BR>
<CODE>CProgramCopy(&lt;tag&gt;, &lt;dir&gt;, &lt;program&gt;)</CODE>
<PRE CLASS="verbatim">
CProgramCopy(install, /usr/bin, foo)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc373">12.4.3.7</A>&nbsp;&nbsp;CProgramInstall</H4><A NAME="@default333"></A><A NAME="@fun214"></A><A NAME="fun:CProgramInstall"></A>
The <CODE>CProgramInstall</CODE> function specifies a program to build,
and a location to install, simultaneously.<BR>
<BR>
<CODE>CProgramInstall(&lt;tag&gt;, &lt;dir&gt;, &lt;name&gt;, &lt;files&gt;)</CODE>
<PRE CLASS="verbatim">
section
   LIBS = libfoo
   LDFLAGS += -lbar
   CProgramInstall(install, /usr/bin, foo, bar baz)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc374">12.4.3.8</A>&nbsp;&nbsp;CXXProgram, CXXProgramInstall</H4><A NAME="@default334"></A><A NAME="@fun215"></A><A NAME="fun:CXXProgram"></A><A NAME="@default335"></A><A NAME="@fun216"></A><A NAME="fun:CXXProgramInstall"></A>
The <CODE>CXXProgram</CODE> and <CODE>CXXProgramInstall</CODE> functions are
equivalent to their C counterparts, except that would use <CODE>$(CXX)</CODE> and <CODE>$(CXXFLAGS)</CODE>
for linking instead of <CODE>$(CC)</CODE> and <CODE>$(CFLAGS)</CODE>.
<A NAME="toc90"></A>
<H2 CLASS="section"><A NAME="htoc375">12.5</A>&nbsp;&nbsp;Building OCaml programs</H2>

<H3 CLASS="subsection"><A NAME="htoc376">12.5.1</A>&nbsp;&nbsp;Autoconfiguration variables for OCaml programs</H3>
These variables will get defined based on the &#8220;autoconf-style&#8221; tests executed when you
run OMakefor the first time. You can use them to configure your project accordingly,
and you should not redefine them.

<H4 CLASS="subsubsection"><A NAME="htoc377">12.5.1.1</A>&nbsp;&nbsp;OCAMLOPT_EXISTS</H4><A NAME="@default336"></A><A NAME="@var44"></A><A NAME="var:OCAMLOPT_EXISTS"></A> True when <CODE>ocamlopt</CODE> (or <CODE>ocamlopt.opt</CODE>) is
 available on your machine.

<H4 CLASS="subsubsection"><A NAME="htoc378">12.5.1.2</A>&nbsp;&nbsp;OCAMLFIND_EXISTS</H4><A NAME="@default337"></A><A NAME="@var45"></A><A NAME="var:OCAMLFIND_EXISTS"></A> True when the ocamlfind is available on your
 machines.

<H4 CLASS="subsubsection"><A NAME="htoc379">12.5.1.3</A>&nbsp;&nbsp;OCAMLDEP_MODULES_AVAILABLE</H4><A NAME="@default338"></A><A NAME="@var46"></A><A NAME="var:OCAMLDEP_MODULES_AVAILABLE"></A> True when a version of
 <CODE>ocamldep</CODE> that understands the <CODE>-modules</CODE> option is available on your machine.

<H4 CLASS="subsubsection"><A NAME="htoc380">12.5.1.4</A>&nbsp;&nbsp;MENHIR_AVAILABLE</H4><A NAME="@default339"></A><A NAME="@var47"></A><A NAME="var:MENHIR_AVAILABLE"></A> True when the Menhir parser-generator is available
 on your machine.<BR>
<BR>

<H3 CLASS="subsection"><A NAME="htoc381">12.5.2</A>&nbsp;&nbsp;Configuration variables for OCaml programs</H3>
The following variables can be redefined in your project.

<H4 CLASS="subsubsection"><A NAME="htoc382">12.5.2.1</A>&nbsp;&nbsp;USE_OCAMLFIND</H4><A NAME="@default340"></A><A NAME="@var48"></A><A NAME="var:USE_OCAMLFIND"></A> Whether to use the <CODE>ocamlfind</CODE> utility (default <CODE>false\</CODE>)

<H4 CLASS="subsubsection"><A NAME="htoc383">12.5.2.2</A>&nbsp;&nbsp;OCAMLC</H4><A NAME="@default341"></A><A NAME="@var49"></A><A NAME="var:OCAMLC"></A> The OCaml bytecode compiler (default <CODE>ocamlc.opt</CODE> if it exists
 and <CODE>USE_OCAMLFIND</CODE> is not set, otherwise <CODE>ocamlc</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc384">12.5.2.3</A>&nbsp;&nbsp;OCAMLOPT</H4><A NAME="@default342"></A><A NAME="@var50"></A><A NAME="var:OCAMLOPT"></A> The OCaml native-code compiler (default <CODE>ocamlopt.opt</CODE> if it
 exists and <CODE>USE_OCAMLFIND</CODE> is not set, otherwise <CODE>ocamlopt</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc385">12.5.2.4</A>&nbsp;&nbsp;CAMLP4</H4><A NAME="@default343"></A><A NAME="@var51"></A><A NAME="var:CAMLP4"></A> The <CODE>camlp4</CODE> preprocessor (default <CODE>camlp4</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc386">12.5.2.5</A>&nbsp;&nbsp;OCAMLLEX</H4><A NAME="@default344"></A><A NAME="@var52"></A><A NAME="var:OCAMLLEX"></A> The OCaml lexer generator (default <CODE>ocamllex</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc387">12.5.2.6</A>&nbsp;&nbsp;OCAMLLEXFLAGS</H4><A NAME="@default345"></A><A NAME="@var53"></A><A NAME="var:OCAMLLEXFLAGS"></A> The flags to pass to <CODE>ocamllex</CODE> (default <CODE>-q</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc388">12.5.2.7</A>&nbsp;&nbsp;OCAMLYACC</H4><A NAME="@default346"></A><A NAME="@var54"></A><A NAME="var:OCAMLYACC"></A> The OCaml parser generator (default <CODE>ocamlyacc</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc389">12.5.2.8</A>&nbsp;&nbsp;OCAMLYACCFLAGS</H4><A NAME="@default347"></A><A NAME="@var55"></A><A NAME="var:OCAMLYACCFLAGS"></A> Additional options to pass to <CODE>$(OCAMLYACC)</CODE>.

<H4 CLASS="subsubsection"><A NAME="htoc390">12.5.2.9</A>&nbsp;&nbsp;OCAMLDEP</H4><A NAME="@default348"></A><A NAME="@var56"></A><A NAME="var:OCAMLDEP"></A> The OCaml dependency analyzer (default <CODE>ocamldep</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc391">12.5.2.10</A>&nbsp;&nbsp;OCAMLDEP_MODULES</H4><A NAME="@default349"></A><A NAME="@var57"></A><A NAME="var:OCAMLDEP_MODULES"></A> The OCaml dependency analyzer that understands the
 <CODE>-module</CODE> option (default <CODE>ocamldep</CODE>, if <CODE>ocamldep -modules</CODE> works, or
 <CODE>ocamlrun ocamldep-omake</CODE>, if <CODE>ocamlrun ocamldep-omake -modules</CODE> works, and empty
 when neither works).

<H4 CLASS="subsubsection"><A NAME="htoc392">12.5.2.11</A>&nbsp;&nbsp;OCAMLDEP_MODULES_ENABLED</H4><A NAME="@default350"></A><A NAME="@var58"></A><A NAME="var:OCAMLDEP_MODULES_ENABLED"></A> Instead of using <CODE>OCAMLDEP</CODE>
 in a traditional <CODE>make</CODE>-style fashion, run <CODE>$(OCAMLDEP_MODULES) -modules</CODE> and then
 postprocess the output internally to discover all the relevant generated <CODE>.ml</CODE> and
 <CODE>.mli</CODE> files. See Section&nbsp;<A HREF="#section:ocaml-generated-files">12.6</A> for more information on
 interactions between OMake, <CODE>OCAMLDEP</CODE> and generated files. This feature is currently
 considered highly experimental and is disabled by default.

<H4 CLASS="subsubsection"><A NAME="htoc393">12.5.2.12</A>&nbsp;&nbsp;OCAMLMKTOP</H4><A NAME="@default351"></A><A NAME="@var59"></A><A NAME="var:OCAMLMKTOP"></A> The OCaml toploop compiler (default <CODE>ocamlmktop</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc394">12.5.2.13</A>&nbsp;&nbsp;OCAMLLINK</H4><A NAME="@default352"></A><A NAME="@var60"></A><A NAME="var:OCAMLLINK"></A> The OCaml bytecode linker (default <CODE>$(OCAMLC)</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc395">12.5.2.14</A>&nbsp;&nbsp;OCAMLOPTLINK</H4><A NAME="@default353"></A><A NAME="@var61"></A><A NAME="var:OCAMLOPTLINK"></A> The OCaml native-code linker (default <CODE>$(OCAMLOPT)</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc396">12.5.2.15</A>&nbsp;&nbsp;OCAMLINCLUDES</H4><A NAME="@default354"></A><A NAME="@var62"></A><A NAME="var:OCAMLINCLUDES"></A> Search path to pass to the OCaml compilers (default <CODE>.</CODE>).
 The search path with the <CODE>-I</CODE> prefix is defined by the <CODE>PREFIXED_OCAMLINCLUDES</CODE>
 variable.

<H4 CLASS="subsubsection"><A NAME="htoc397">12.5.2.16</A>&nbsp;&nbsp;OCAMLFIND</H4><A NAME="@default355"></A><A NAME="@var63"></A><A NAME="var:OCAMLFIND"></A> The <CODE>ocamlfind</CODE> utility (default <CODE>ocamlfind</CODE> if
 <CODE>USE_OCAMLFIND</CODE> is set, otherwise empty).

<H4 CLASS="subsubsection"><A NAME="htoc398">12.5.2.17</A>&nbsp;&nbsp;OCAMLFINDFLAGS</H4><A NAME="@default356"></A><A NAME="@var64"></A><A NAME="var:OCAMLFINDFLAGS"></A> The flags to pass to <CODE>ocamlfind</CODE> (default empty, <CODE>USE_OCAMLFIND</CODE> must be set).

<H4 CLASS="subsubsection"><A NAME="htoc399">12.5.2.18</A>&nbsp;&nbsp;OCAMLPACKS</H4><A NAME="@default357"></A><A NAME="@var65"></A><A NAME="var:OCAMLPACKS"></A> Package names to pass to <CODE>ocamlfind</CODE> (<CODE>USE_OCAMLFIND</CODE> must be set).

<H4 CLASS="subsubsection"><A NAME="htoc400">12.5.2.19</A>&nbsp;&nbsp;BYTE_ENABLED</H4><A NAME="@default358"></A><A NAME="@var66"></A><A NAME="var:BYTE_ENABLED"></A> Flag indicating whether to use the bytecode compiler (default <CODE>true</CODE>, when no <CODE>ocamlopt</CODE> found, <CODE>false</CODE> otherwise).

<H4 CLASS="subsubsection"><A NAME="htoc401">12.5.2.20</A>&nbsp;&nbsp;NATIVE_ENABLED</H4><A NAME="@default359"></A><A NAME="@var67"></A><A NAME="var:NATIVE_ENABLED"></A> Flag indicating whether to use the native-code compiler (default <CODE>true</CODE>, when ocamlopt is found, <CODE>false</CODE> otherwise).
 Both <CODE>BYTE_ENABLED</CODE> and <CODE>NATIVE_ENABLED</CODE> can be set to true;
 at least one should be set to true.

<H4 CLASS="subsubsection"><A NAME="htoc402">12.5.2.21</A>&nbsp;&nbsp;MENHIR_ENABLED</H4><A NAME="@default360"></A><A NAME="@var68"></A><A NAME="var:MENHIR_ENABLED"></A> Define this as <CODE>true</CODE> if you wish to use
 <CODE>menhir</CODE> instead of <CODE>ocamlyacc</CODE> (default <CODE>false</CODE>).

<H3 CLASS="subsection"><A NAME="htoc403">12.5.3</A>&nbsp;&nbsp;OCaml command flags</H3>
The following variables specify <EM>additional</EM> options to be passed to
the OCaml tools.

<H4 CLASS="subsubsection"><A NAME="htoc404">12.5.3.1</A>&nbsp;&nbsp;OCAMLDEPFLAGS</H4><A NAME="@default361"></A><A NAME="@var69"></A><A NAME="var:OCAMLDEPFLAGS"></A> Flags to pass to <CODE>OCAMLDEP</CODE> (but not to <CODE>OCAMLDEP_MODULES</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc405">12.5.3.2</A>&nbsp;&nbsp;OCAMLPPFLAGS</H4><A NAME="@default362"></A><A NAME="@var70"></A><A NAME="var:OCAMLPPFLAGS"></A> Flags to pass to <CODE>CAMLP4</CODE>.

<H4 CLASS="subsubsection"><A NAME="htoc406">12.5.3.3</A>&nbsp;&nbsp;OCAMLCFLAGS</H4><A NAME="@default363"></A><A NAME="@var71"></A><A NAME="var:OCAMLCFLAGS"></A> Flags to pass to the byte-code compiler (default <CODE>-g</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc407">12.5.3.4</A>&nbsp;&nbsp;OCAMLOPTFLAGS</H4><A NAME="@default364"></A><A NAME="@var72"></A><A NAME="var:OCAMLOPTFLAGS"></A> Flags to pass to the native-code compiler (default empty).

<H4 CLASS="subsubsection"><A NAME="htoc408">12.5.3.5</A>&nbsp;&nbsp;OCAMLFLAGS</H4><A NAME="@default365"></A><A NAME="@var73"></A><A NAME="var:OCAMLFLAGS"></A> Flags to pass to either compiler (default <CODE>-warn-error A</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc409">12.5.3.6</A>&nbsp;&nbsp;OCAML_BYTE_LINK_FLAGS</H4><A NAME="@default366"></A><A NAME="@var74"></A><A NAME="var:OCAML_BYTE_LINK_FLAGS"></A> Flags to pass to the byte-code linker (default empty).

<H4 CLASS="subsubsection"><A NAME="htoc410">12.5.3.7</A>&nbsp;&nbsp;OCAML_NATIVE_LINK_FLAGS</H4><A NAME="@default367"></A><A NAME="@var75"></A><A NAME="var:OCAML_NATIVE_LINK_FLAGS"></A> Flags to pass to the native-code linker (default empty).

<H4 CLASS="subsubsection"><A NAME="htoc411">12.5.3.8</A>&nbsp;&nbsp;OCAML_LINK_FLAGS</H4><A NAME="@default368"></A><A NAME="@var76"></A><A NAME="var:OCAML_LINK_FLAGS"></A> Flags to pass to either linker.

<H4 CLASS="subsubsection"><A NAME="htoc412">12.5.3.9</A>&nbsp;&nbsp;MENHIR_FLAGS</H4><A NAME="@default369"></A><A NAME="@var77"></A><A NAME="var:MENHIR_FLAGS"></A> Additional flags to pass to <CODE>menhir</CODE>.

<H3 CLASS="subsection"><A NAME="htoc413">12.5.4</A>&nbsp;&nbsp;Library variables</H3>
The following variables are used during linking.<BR>
<BR>

<H4 CLASS="subsubsection"><A NAME="htoc414">12.5.4.1</A>&nbsp;&nbsp;OCAML_LIBS</H4><A NAME="@default370"></A><A NAME="@var78"></A><A NAME="var:OCAML_LIBS"></A> Libraries to pass to the linker. These libraries become dependencies
 of the link step.

<H4 CLASS="subsubsection"><A NAME="htoc415">12.5.4.2</A>&nbsp;&nbsp;OCAML_OTHER_LIBS</H4><A NAME="@default371"></A><A NAME="@var79"></A><A NAME="var:OCAML_OTHER_LIBS"></A> Additional libraries to pass to the linker. These libraries are
 <EM>not</EM> included as dependencies to the link step. Typical use is for the OCaml
 standard libraries like <CODE>unix</CODE> or <CODE>str</CODE>.

<H4 CLASS="subsubsection"><A NAME="htoc416">12.5.4.3</A>&nbsp;&nbsp;OCAML_CLIBS</H4><A NAME="@default372"></A><A NAME="@var80"></A><A NAME="var:OCAML_CLIBS"></A> C libraries to pass to the linker.

<H4 CLASS="subsubsection"><A NAME="htoc417">12.5.4.4</A>&nbsp;&nbsp;OCAML_LIB_FLAGS</H4><A NAME="@default373"></A><A NAME="@var81"></A><A NAME="var:OCAML_LIB_FLAGS"></A> Extra flags for the library.
<A NAME="toc91"></A>
<H2 CLASS="section"><A NAME="htoc418">12.6</A>&nbsp;&nbsp;Generated OCaml Files</H2>
<A NAME="section:ocaml-generated-files"></A>
As of OCaml version 3.09.2, the standard <CODE>ocamldep</CODE> scanner is &#8220;broken&#8221;. The main issue is
that it finds only those dependencies that already exist. If <CODE>foo.ml</CODE> contains a dependency
on <CODE>Bar</CODE>,
<PRE CLASS="verbatim">
foo.ml:
   open Bar
</PRE>then the default <CODE>ocamldep</CODE> will only find the dependency if a file <CODE>bar.ml</CODE> or
<CODE>bar.ml</CODE> exists in the include path. It will not find (or print) the dependency if, for
example, only <CODE>bar.mly</CODE> exists at the time <CODE>ocamldep</CODE> is run, even though <CODE>bar.ml</CODE>
and <CODE>bar.mli</CODE> can be generated from <CODE>bar.mly</CODE>.<BR>
<BR>
OMake currently provides two methods for addressing this problem &mdash; one that requires manually
specifying the generated files, and an experimental method for discovering such &#8220;hidden&#8221;
dependencies automatically. The variable
<CODE>OCAMLDEP_MODULES_ENABLED</CODE>&nbsp;<A HREF="#var:OCAMLDEP_MODULES_ENABLED">12.5.2.11</A> controls which method is
going to be used. When this variable is false, the manual specifications are expected and when it
is true, the automated discovery will be attempted.<BR>
<BR>

<H4 CLASS="subsubsection"><A NAME="htoc419">12.6.0.5</A>&nbsp;&nbsp;OCamlGeneratedFiles, LocalOCamlGeneratedFiles</H4><A NAME="@default374"></A><A NAME="@fun217"></A><A NAME="fun:OCamlGeneratedFiles"></A><A NAME="@default375"></A><A NAME="@fun218"></A><A NAME="fun:LocalOCamlGeneratedFiles"></A>
<PRE CLASS="verbatim">
OCamlGeneratedFiles(files)
LocalOCamlGeneratedFiles(files)
</PRE>
When the <CODE>OCAMLDEP_MODULES_ENABLED</CODE>&nbsp;<A HREF="#var:OCAMLDEP_MODULES_ENABLED">12.5.2.11</A> variable is set
to <CODE>false</CODE>, the <CODE>OCamlGeneratedFiles</CODE> and <CODE>LocalOCamlGeneratedFiles</CODE> functions specify files
that need to be generated before any OCaml files are scanned for dependencies. For example,
if <CODE>parser.ml</CODE> and <CODE>lexer.ml</CODE> are both generated files, specify:
<PRE CLASS="verbatim">
OCamlGeneratedFiles(parser.ml lexer.ml)
</PRE>
The <CODE>OCamlGeneratedFiles</CODE> function is <EM>global</EM> &mdash; its arguments will be generated
before any OCaml files anywhere in the project are scanned for dependencies. The
<CODE>LocalOCamlGeneratedFiles</CODE> function follows the normal scoping rules of OMake.<BR>
<BR>
These functions have no effect when
<CODE>OCAMLDEP_MODULES_ENABLED</CODE>&nbsp;<A HREF="#var:OCAMLDEP_MODULES_ENABLED">12.5.2.11</A> is true.<BR>
<BR>

<H4 CLASS="subsubsection"><A NAME="htoc420">12.6.0.6</A>&nbsp;&nbsp;Automatic discovery of generated files during dependency analysis.</H4>
Having to specify the generated files manualy when OMake could discover them automatically is
obviously suboptimal. To address this, we try to use a custom <CODE>ocamldep</CODE> that <EM>only</EM>
finds the free module names in a file. <BR>
<BR>
This functionality is experimental and is disabled by default for now.
Set <CODE>OCAMLDEP_MODULES_ENABLED</CODE>&nbsp;<A HREF="#var:OCAMLDEP_MODULES_ENABLED">12.5.2.11</A> to <CODE>true</CODE> (or
to <CODE>$(OCAMLDEP_MODULES_AVAILABLE)</CODE> in your project to enable it.<BR>
<BR>
Note that the experimental <CODE>ocamldep</CODE> functionality this relies upon is not yet included in
the standard OCaml &mdash; see <A HREF="http://caml.inria.fr/mantis/view.php?id=4047"><TT>http://caml.inria.fr/mantis/view.php?id=4047</TT></A>. Temporarily, we
distribute a bytecode version <A NAME="@default376"></A><CODE>ocamldep-omake</CODE> of the appropriately
modified <CODE>ocamldep</CODE>. The appropriate <CODE>ocamldep</CODE> will be discovered automatically &mdash; see
Sections&nbsp;<A HREF="#var:OCAMLDEP_MODULES_AVAILABLE">12.5.1.3</A> and&nbsp;<A HREF="#var:OCAMLDEP_MODULES">12.5.2.10</A>.

<H3 CLASS="subsection"><A NAME="htoc421">12.6.1</A>&nbsp;&nbsp;Using the Menhir parser generator</H3>
Menhir is a parser generator that is mostly compatible with
<CODE>ocamlyacc</CODE>, but with many improvements. A few of these
are listed here (excerpted from the Menhir home page
<A HREF="http://cristal.inria.fr/~fpottier/menhir/"><TT>http://cristal.inria.fr/~fpottier/menhir/</TT></A>).
<UL CLASS="itemize"><LI CLASS="li-itemize">
Menhir's explanations are believed to be understandable by mere humans.
<LI CLASS="li-itemize">Menhir allows grammar specifications to be split over multiple files.
 It also allows several grammars to share a single set of tokens.
<LI CLASS="li-itemize">Menhir is able to produce parsers that are parameterized by Objective Caml modules.
<LI CLASS="li-itemize">Added by jyh With the <CODE>--infer</CODE> option, Menhir can typecheck the semantic actions
 in your grammar at <EM>generation</EM> time.
</UL>
What do you need to do to use Menhir instead of <CODE>ocamlyacc</CODE>?
<OL CLASS="enumerate" type=1><LI CLASS="li-enumerate">
Place the following definition before the relevant section of your project
 (or at the top of your project <CODE>OMakefile</CODE> if you want to use Menhir everywhere).
<PRE CLASS="verbatim">
   MENHIR_ENABLED = true
</PRE><BR>
<BR>
<LI CLASS="li-enumerate">Optionally, add any desired Menhir options to the <CODE>MENHIR_FLAGS</CODE> variable.
<PRE CLASS="verbatim">
   MENHIR_FLAGS += --infer
</PRE></OL>
With this setup, any file with a <CODE>.mly</CODE> suffix will be compiled with Menhir.<BR>
<BR>
If your grammar is split across several files, you need to specify it explicitly,
using the <CODE>MenhirMulti</CODE> function.
<PRE CLASS="verbatim">
    MenhirMulti(target, sources)
        target : filename, without suffix
        sources : the files that define the grammar, without suffixes
</PRE>
For example, if you want to generate the parser files <CODE>parse.ml</CODE> and <CODE>parse.mli</CODE>,
from the grammar specified in files <CODE>a.mly</CODE> and <CODE>b.mly</CODE>, you would use
the following.
<PRE CLASS="verbatim">
    MenhirMulti(parse, a b)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc422">12.6.1.1</A>&nbsp;&nbsp;OCamlLibrary</H4><A NAME="@default377"></A><A NAME="@fun219"></A><A NAME="fun:OCamlLibrary"></A>
The <CODE>OCamlLibrary</CODE> function builds an OCaml library.<BR>
<BR>
<CODE>OCamlLibrary(&lt;libname&gt;, &lt;files&gt;)</CODE><BR>
<BR>
The <CODE>&lt;libname&gt;</CODE> and <CODE>&lt;files&gt;</CODE> are listed <EM>without</EM> suffixes.<BR>
<BR>

<H4 CLASS="subsubsection"><A NAME="htoc423">12.6.1.2</A>&nbsp;&nbsp;ABORT_ON_DEPENDENCY_ERRORS</H4><A NAME="@default378"></A><A NAME="@var82"></A><A NAME="var:ABORT_ON_DEPENDENCY_ERRORS"></A>
 The linker requires that the files to be
 listed in dependency order. If this variable is true, the order of
 the files is determined by the command line, but <TT>omake</TT> will
 abort with an error message if the order is illegal. Otherwise,
 the files are sorted automatically.<BR>
<BR>
This function returns the list of all the targets that it defines the rules
for (including the <CODE>$(name)$(EXT_LIB)</CODE> file when <CODE>NATIVE_ENABLED</CODE> is set).<BR>
<BR>
The following code builds the <CODE>libfoo.cmxa</CODE> library from the files <CODE>foo.cmx</CODE>
and <CODE>bar.cmx</CODE> (if <CODE>NATIVE_ENABLED</CODE> is set), and <CODE>libfoo.cma</CODE> from
<CODE>foo.cmo</CODE> and <CODE>bar.cmo</CODE> (if <CODE>BYTE_ENABLED</CODE> is set).
<PRE CLASS="verbatim">
OCamlLibrary(libfoo, foo bar)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc424">12.6.1.3</A>&nbsp;&nbsp;OCamlPackage</H4><A NAME="@default379"></A><A NAME="@fun220"></A><A NAME="fun:OCamlPackage"></A>
The <CODE>OCamlPackage</CODE> function builds an OCaml package.<BR>
<BR>
<CODE>OCamlPackage(&lt;name&gt;, &lt;files&gt;)</CODE><BR>
<BR>
The <CODE>&lt;name&gt;</CODE> and <CODE>&lt;files&gt;</CODE> are listed <EM>without</EM> suffixes.
The <CODE>&lt;files&gt;</CODE> must have been compiled with the <CODE>-for-pack &lt;ident&gt;</CODE>
flag to the OCaml compiler.<BR>
<BR>
This function returns the list of all the targets that it defines the rules
for (including the <CODE>$(name)$(EXT_LIB)</CODE> file when <CODE>NATIVE_ENABLED</CODE> is set).<BR>
<BR>
The following code builds the <CODE>libfoo.cmx</CODE> package from the files <CODE>package.cmx</CODE>
and <CODE>bar.cmx</CODE> (if <CODE>NATIVE_ENABLED</CODE> is set), and <CODE>package.cmo</CODE> from
<CODE>foo.cmo</CODE> and <CODE>bar.cmo</CODE> (if <CODE>BYTE_ENABLED</CODE> is set).
<PRE CLASS="verbatim">
OCamlPackage(package, foo bar)
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc425">12.6.1.4</A>&nbsp;&nbsp;OCamlLibraryCopy</H4><A NAME="@default380"></A><A NAME="@fun221"></A><A NAME="fun:OCamlLibraryCopy"></A>
The <CODE>OCamlLibraryCopy</CODE> function copies a library to an install location.<BR>
<BR>
<CODE>OCamlLibraryCopy(&lt;tag&gt;, &lt;libdir&gt;, &lt;libname&gt;, &lt;interface-files&gt;)</CODE><BR>
<BR>
The <CODE>&lt;interface-files&gt;</CODE> specify additional interface files
to be copied if the <CODE>INSTALL_INTERFACES</CODE> variable is true.

<H4 CLASS="subsubsection"><A NAME="htoc426">12.6.1.5</A>&nbsp;&nbsp;OCamlLibraryInstall</H4><A NAME="@default381"></A><A NAME="@fun222"></A><A NAME="fun:OCamlLibraryInstall"></A>
The <CODE>OCamlLibraryInstall</CODE> function builds a library
and copies it to an install location in one step.<BR>
<BR>
<CODE>OCamlLibraryInstall(&lt;tag&gt;, &lt;libdir&gt;, &lt;libname&gt;, &lt;files&gt;)</CODE>

<H4 CLASS="subsubsection"><A NAME="htoc427">12.6.1.6</A>&nbsp;&nbsp;OCamlProgram</H4><A NAME="@default382"></A><A NAME="@fun223"></A><A NAME="fun:OCamlProgram"></A>
The <CODE>OCamlProgram</CODE> function builds an OCaml program. It returns the array with all
the targets for which it has defined the rules (<CODE>$(name)$(EXE)</CODE> and <CODE>$(name).run</CODE>
and/or <CODE>$(name).opt</CODE>, depending on the <CODE>NATIVE_ENABLED</CODE> and <CODE>BYTE_ENABLED</CODE>
variables).<BR>
<BR>
<CODE>OCamlProgram(&lt;name&gt;, &lt;files&gt;)</CODE><BR>
<BR>
Additional variables used:
<DL CLASS="description" COMPACT=compact><DT CLASS="dt-description">
<B>OCAML_LIBS&nbsp;</B><A HREF="#var:OCAML_LIBS"><B>12.5.4.1</B></A><DD CLASS="dd-description"> Additional libraries passed to the linker, without suffix. These files
 become dependencies of the target program.
<DT CLASS="dt-description"><B>OCAML_OTHER_LIBS&nbsp;</B><A HREF="#var:OCAML_OTHER_LIBS"><B>12.5.4.2</B></A><DD CLASS="dd-description"> Additional libraries passed to the linker, without suffix. These
 files do <EM>not</EM> become dependencies of the target program.
<DT CLASS="dt-description"><B>OCAML_CLIBS&nbsp;</B><A HREF="#var:OCAML_CLIBS"><B>12.5.4.3</B></A><DD CLASS="dd-description"> C libraries to pass to the linker.
<DT CLASS="dt-description"><B>OCAML_BYTE_LINK_FLAGS&nbsp;</B><A HREF="#var:OCAML_BYTE_LINK_FLAGS"><B>12.5.3.6</B></A><DD CLASS="dd-description"> Flags to pass to the bytecode linker.
<DT CLASS="dt-description"><B>OCAML_NATIVE_LINK_FLAGS&nbsp;</B><A HREF="#var:OCAML_NATIVE_LINK_FLAGS"><B>12.5.3.7</B></A><DD CLASS="dd-description"> Flags to pass to the native code linker.
<DT CLASS="dt-description"><B>OCAML_LINK_FLAGS&nbsp;</B><A HREF="#var:OCAML_LINK_FLAGS"><B>12.5.3.8</B></A><DD CLASS="dd-description"> Flags to pass to both linkers.
</DL>

<H4 CLASS="subsubsection"><A NAME="htoc428">12.6.1.7</A>&nbsp;&nbsp;OCamlProgramCopy</H4><A NAME="@default383"></A><A NAME="@fun224"></A><A NAME="fun:OCamlProgramCopy"></A>
The <CODE>OCamlProgramCopy</CODE> function copies an OCaml program to an install location.<BR>
<BR>
<CODE>OCamlProgramCopy(&lt;tag&gt;, &lt;bindir&gt;, &lt;name&gt;)</CODE><BR>
<BR>
Additional variables used:
<DL CLASS="description" COMPACT=compact><DT CLASS="dt-description">
<B>NATIVE_ENABLED</B><DD CLASS="dd-description"> If <CODE>NATIVE_ENABLED</CODE>&nbsp;<A HREF="#var:NATIVE_ENABLED">12.5.2.20</A> is set, the native-code executable
 is copied; otherwise the byte-code executable is copied.
</DL>

<H4 CLASS="subsubsection"><A NAME="htoc429">12.6.1.8</A>&nbsp;&nbsp;OCamlProgramInstall</H4><A NAME="@default384"></A><A NAME="@fun225"></A><A NAME="fun:OCamlProgramInstall"></A>
The <CODE>OCamlProgramInstall</CODE> function builds a programs and copies it to
an install location in one step.<BR>
<BR>
<CODE>OCamlProgramInstall(&lt;tag&gt;, &lt;bindir&gt;, &lt;name&gt;, &lt;files&gt;)</CODE>
<A NAME="toc92"></A>
<H2 CLASS="section"><A NAME="htoc430">12.7</A>&nbsp;&nbsp;Building L<sup>A</sup>T<sub>E</sub>X programs</H2>

<H3 CLASS="subsection"><A NAME="htoc431">12.7.1</A>&nbsp;&nbsp;Configuration variables</H3>
The following variables can be modified in your project.

<H4 CLASS="subsubsection"><A NAME="htoc432">12.7.1.1</A>&nbsp;&nbsp;LATEX</H4><A NAME="@default385"></A><A NAME="@var83"></A><A NAME="var:LATEX"></A> The L<sup>A</sup>T<sub>E</sub>X command (default <CODE>latex</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc433">12.7.1.2</A>&nbsp;&nbsp;TETEX2_ENABLED</H4><A NAME="@default386"></A><A NAME="@var84"></A><A NAME="var:TETEX2_ENABLED"></A> Flag indicating whether to use advanced L<sup>A</sup>T<sub>E</sub>X options
present in TeTeX v.2 (default value is determined the first time omake reads <CODE>LaTeX.src</CODE>
and depends on the version of L<sup>A</sup>T<sub>E</sub>X you have installed).

<H4 CLASS="subsubsection"><A NAME="htoc434">12.7.1.3</A>&nbsp;&nbsp;LATEXFLAGS</H4><A NAME="@default387"></A><A NAME="@var85"></A><A NAME="var:LATEXFLAGS"></A> The L<sup>A</sup>T<sub>E</sub>X flags (defaults depend on the <CODE>TETEX2_ENABLED</CODE> variable)

<H4 CLASS="subsubsection"><A NAME="htoc435">12.7.1.4</A>&nbsp;&nbsp;BIBTEX</H4><A NAME="@default388"></A><A NAME="@var86"></A><A NAME="var:BIBTEX"></A> The BibTeX command (default <CODE>bibtex</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc436">12.7.1.5</A>&nbsp;&nbsp;MAKEINDEX</H4><A NAME="@default389"></A><A NAME="@var87"></A><A NAME="var:MAKEINDEX"></A> The command to build an index (default <CODE>makeindex</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc437">12.7.1.6</A>&nbsp;&nbsp;DVIPS</H4><A NAME="@default390"></A><A NAME="@var88"></A><A NAME="var:DVIPS"></A> The <CODE>.dvi</CODE> to PostScript converter (default <CODE>dvips</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc438">12.7.1.7</A>&nbsp;&nbsp;DVIPSFLAGS</H4><A NAME="@default391"></A><A NAME="@var89"></A><A NAME="var:DVIPSFLAGS"></A> Flags to pass to <CODE>dvips</CODE> (default <CODE>-t letter</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc439">12.7.1.8</A>&nbsp;&nbsp;DVIPDFM</H4><A NAME="@default392"></A><A NAME="@var90"></A><A NAME="var:DVIPDFM"></A> The <CODE>.dvi</CODE> to <CODE>.pdf</CODE> converter (default <CODE>dvipdfm</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc440">12.7.1.9</A>&nbsp;&nbsp;DVIPDFMFLAGS</H4><A NAME="@default393"></A><A NAME="@var91"></A><A NAME="var:DVIPDFMFLAGS"></A> Flags to pass to <CODE>dvipdfm</CODE> (default <CODE>-p letter</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc441">12.7.1.10</A>&nbsp;&nbsp;PDFLATEX</H4><A NAME="@default394"></A><A NAME="@var92"></A><A NAME="var:PDFLATEX"></A> The <CODE>.latex</CODE> to <CODE>.pdf</CODE> converter (default <CODE>pdflatex</CODE>).

<H4 CLASS="subsubsection"><A NAME="htoc442">12.7.1.11</A>&nbsp;&nbsp;PDFLATEXFLAGS</H4><A NAME="@default395"></A><A NAME="@var93"></A><A NAME="var:PDFLATEXFLAGS"></A> Flags to pass to pdflatex (default is empty).

<H4 CLASS="subsubsection"><A NAME="htoc443">12.7.1.12</A>&nbsp;&nbsp;USEPDFLATEX</H4><A NAME="@default396"></A><A NAME="@var94"></A><A NAME="var:USEPDFLATEX"></A> Flag indicating whether to use pdflatex instead of dvipdfm
to generate the <CODE>.pdf</CODE> document (default <CODE>false</CODE>).

<H3 CLASS="subsection"><A NAME="htoc444">12.7.2</A>&nbsp;&nbsp;Building L<sup>A</sup>T<sub>E</sub>X documents</H3>

<H4 CLASS="subsubsection"><A NAME="htoc445">12.7.2.1</A>&nbsp;&nbsp;LaTeXDocument</H4><A NAME="@default397"></A><A NAME="@fun226"></A><A NAME="fun:LaTeXDocument"></A>
The <CODE>LaTeXDocument</CODE> produces a L<sup>A</sup>T<sub>E</sub>X document.<BR>
<BR>
<CODE>LaTeXDocument(&lt;name&gt;, &lt;texfiles&gt;)</CODE><BR>
<BR>
The document <CODE>&lt;name&gt;</CODE> and <CODE>&lt;texfiles&gt;</CODE> are listed without suffixes. This function
returns the filenames for the generated <CODE>.ps</CODE> and <CODE>.pdf</CODE> files.<BR>
<BR>
Additional variables used:

<H4 CLASS="subsubsection"><A NAME="htoc446">12.7.2.2</A>&nbsp;&nbsp;TEXINPUTS</H4><A NAME="@default398"></A><A NAME="@var95"></A><A NAME="var:TEXINPUTS"></A>
The L<sup>A</sup>T<sub>E</sub>X search path (an array of directories, default is
 taken from the <CODE>TEXINPUTS</CODE> environment variable).

<H4 CLASS="subsubsection"><A NAME="htoc447">12.7.2.3</A>&nbsp;&nbsp;TEXDEPS</H4><A NAME="@default399"></A><A NAME="@var96"></A><A NAME="var:TEXDEPS"></A> Additional files this document depends on.

<H4 CLASS="subsubsection"><A NAME="htoc448">12.7.2.4</A>&nbsp;&nbsp;TeXGeneratedFiles, LocalTeXGeneratedFiles</H4><A NAME="@default400"></A><A NAME="@fun227"></A><A NAME="fun:TeXGeneratedFiles"></A><A NAME="@default401"></A><A NAME="@fun228"></A><A NAME="fun:LocalTeXGeneratedFiles"></A>
<PRE CLASS="verbatim">
TeXGeneratedFiles(files)
LocalTeXGeneratedFiles(files)
</PRE>
The <CODE>TeXGeneratedFiles</CODE> and <CODE>LocalTeXGeneratedFiles</CODE> functions specify files
that need to be generated before any L<sup>A</sup>T<sub>E</sub>Xfiles are scanned for dependencies. For example,
if <CODE>config.tex</CODE> and <CODE>inputs.tex</CODE> are both generated files, specify:
<PRE CLASS="verbatim">
    TeXGeneratedFiles(config.tex inputs.tex)
</PRE>
The <CODE>TeXGeneratedFiles</CODE> function is <EM>global</EM> &mdash; its arguments will be generated
before any TeX files anywhere in the project are scanned for dependencies. The
<CODE>LocalTeXGeneratedFiles</CODE> function follows the normal scoping rules of OMake.<BR>
<BR>

<H4 CLASS="subsubsection"><A NAME="htoc449">12.7.2.5</A>&nbsp;&nbsp;LaTeXDocumentCopy</H4><A NAME="@default402"></A><A NAME="@fun229"></A><A NAME="fun:LaTeXDocumentCopy"></A>
The <CODE>LaTeXDocumentCopy</CODE> copies the document to an install location.<BR>
<BR>
<CODE>LaTeXDocumentCopy(&lt;tag&gt;, &lt;libdir&gt;, &lt;installname&gt;, &lt;docname&gt;)</CODE><BR>
<BR>
This function copies just the <CODE>.pdf</CODE> and <CODE>.ps</CODE> files.

<H4 CLASS="subsubsection"><A NAME="htoc450">12.7.2.6</A>&nbsp;&nbsp;LaTeXDocumentInstall</H4><A NAME="@default403"></A><A NAME="@fun230"></A><A NAME="fun:LaTeXDocumentInstall"></A>
The <CODE>LaTeXDocumentInstall</CODE> builds a document and copies it to an
install location in one step.<BR>
<BR>
<CODE>LaTeXDocumentInstall(&lt;tag&gt;, &lt;libdir&gt;, &lt;installname&gt;, &lt;docname&gt;, &lt;files&gt;)</CODE>
<A NAME="toc93"></A>
<H2 CLASS="section"><A NAME="htoc451">12.8</A>&nbsp;&nbsp;Examining the dependency graph</H2>

<H4 CLASS="subsubsection"><A NAME="htoc452">12.8.0.7</A>&nbsp;&nbsp;dependencies, dependencies-all</H4><A NAME="@default404"></A><A NAME="@fun231"></A><A NAME="fun:dependencies"></A><A NAME="@default405"></A><A NAME="@fun232"></A><A NAME="fun:dependencies-all"></A>
<PRE CLASS="verbatim">
   $(dependencies targets) : File Array
   $(dependencies-all targets) : File Array
   $(dependencies-proper targets) : File Array
      targets : File Array
   raises RuntimeException
</PRE>
The <CODE>dependencies</CODE> function returns the set of immediate dependencies of
the given targets. This function can only be used within a rule body and
all the arguments to the <CODE>dependency</CODE> function must also be dependencies of
this rule. This restriction ensures that all the dependencies are known when
this function is executed.<BR>
<BR>
The <CODE>dependencies-all</CODE> function is similar, but it expands the dependencies
recursively, returning all of the dependencies of a target, not just the immediate
ones.<BR>
<BR>
The <CODE>dependencies-proper</CODE> function returns all recursive dependencies, except
the dependencies that are leaf targets. A leaf target is a target that has no
dependencies and no build commands; a leaf target corresponds to a source file
in the current project.<BR>
<BR>
In all three functions, files that are not part of the current project are silently
discarded.<BR>
<BR>
One purpose of the <CODE>dependencies-proper</CODE> function is for &#8220;clean&#8221; targets.
For example, one way to delete all intermediate files in a build is with a rule
that uses the <CODE>dependencies-proper</CODE>. Note however, that the rule requires
building the project before it can be deleted. For a shorter form, see the
<CODE>filter-proper-targets</CODE> function.
<PRE CLASS="verbatim">
    .PHONY: clean

    APP = ...     # the name of the target application
    clean: $(APP)
       rm $(dependencies-proper $(APP))
</PRE>

<H4 CLASS="subsubsection"><A NAME="htoc453">12.8.0.8</A>&nbsp;&nbsp;target</H4><A NAME="@default406"></A><A NAME="@fun233"></A><A NAME="fun:target"></A>
<PRE CLASS="verbatim">
   $(target targets) : Target Array
      targets : File Sequence
   raises RuntimeException
</PRE>
The <CODE>target</CODE> function returns the Target object associated with each
of the targets. See the <CODE>Target</CODE> object for more information.

<H4 CLASS="subsubsection"><A NAME="htoc454">12.8.0.9</A>&nbsp;&nbsp;find-build-targets</H4><A NAME="@default407"></A><A NAME="@fun234"></A><A NAME="fun:find-build-targets"></A>
<PRE CLASS="verbatim">
    $(build-targets tag) : Target Array
       tag : Succeeded | Failed
</PRE>
The <CODE>build-targets</CODE> allow the results
of the build to be examined. The <CODE>tag</CODE> must
specifies which targets are to be returned; the comparison
is case-insensitive.
<DL CLASS="description" COMPACT=compact><DT CLASS="dt-description">
<B>Succeeded</B><DD CLASS="dd-description"> The list of targets that were built successfully.
<DT CLASS="dt-description"><B>Failed</B><DD CLASS="dd-description"> The list of targets that could not be built.
</DL>
These are used mainly in conjuction with the
<CODE>.BUILD_SUCCESS</CODE>&nbsp;<A HREF="#target:.BUILD_SUCCESS">12.1</A> and
<CODE>.BUILD_FAILURE</CODE>&nbsp;<A HREF="#target:.BUILD_FAILURE">12.1</A> phony targets.
For example, adding the following to your project <CODE>OMakefile</CODE>
will print the number of targets that failed (if the build failed).
<PRE CLASS="verbatim">
    .BUILD_FAILURE:
        echo "Failed target count: $(length $(failed-targets))"
</PRE>
<H4 CLASS="subsubsection"><A NAME="htoc455">12.8.0.10</A>&nbsp;&nbsp;project-directories</H4><A NAME="@default408"></A><A NAME="@fun235"></A><A NAME="fun:project-directories"></A>
<PRE CLASS="verbatim">
   $(project-directories) : Dir Array
</PRE>
The <CODE>project-directories</CODE> function returns the list of all directories
that are considered to be part of the project.<BR>
<BR>
To get the complete directory list, this function should be called
from within a rule body.

<H4 CLASS="subsubsection"><A NAME="htoc456">12.8.0.11</A>&nbsp;&nbsp;rule</H4><A NAME="@default409"></A><A NAME="@fun236"></A><A NAME="fun:rule"></A>
The <CODE>rule</CODE> function is called whenever a build rule is defined.
It is unlikely that you will need to redefine this function, except in
very exceptional cases.
<PRE CLASS="verbatim">
   rule(multiple, target, pattern, sources, options, body) : Rule
      multiple : String
      target   : Sequence
      pattern  : Sequence
      sources  : Sequence
      options  : Array
      body     : Body
</PRE>
The <CODE>rule</CODE> function is called when a rule is evaluated.
<DL CLASS="description" COMPACT=compact><DT CLASS="dt-description">
<B>multiple</B><DD CLASS="dd-description"> A Boolean value indicating whether the rule was defined
 with a double colon <CODE>::</CODE>.
<DT CLASS="dt-description"><B>target</B><DD CLASS="dd-description"> The sequence of target names.
<DT CLASS="dt-description"><B>pattern</B><DD CLASS="dd-description"> The sequence of patterns. This sequence will be empty
 for two-part rules.
<DT CLASS="dt-description"><B>sources</B><DD CLASS="dd-description"> The sequence of dependencies.
<DT CLASS="dt-description"><B>options</B><DD CLASS="dd-description"> An array of options. Each option is represented
 as a <CODE>Map</CODE>&nbsp;<A HREF="omake-pervasives.html#obj:Map">11.1.2</A> associating each specified option with
 a value.
<DT CLASS="dt-description"><B>body</B><DD CLASS="dd-description"> The body expression of the rule.
</DL>
Consider the following rule.
<PRE CLASS="verbatim">
   target: pattern: sources :name1: option1 :name2: option2
      expr1
      expr2
</PRE>
This expression represents the following function call, where
square brackets are used to indicate arrays, and the curly
brackets represent a <CODE>Map</CODE>&nbsp;<A HREF="omake-pervasives.html#obj:Map">11.1.2</A>.
<PRE CLASS="verbatim">
   rule(false, target, pattern, sources,
        { $|:name1:| = option1; $|:name2:| = option2 }
        [expr1; expr2])
</PRE>

<TABLE CELLSPACING=2 CELLPADDING=0>
<TR><TD ALIGN=left NOWRAP>Jump to:</TD>
<TD VALIGN=top ALIGN=center NOWRAP>&nbsp;&nbsp;</TD>
<TD ALIGN=left NOWRAP><A HREF="http://omake.metaprl.org/">OMake Home</A>
&bull;&nbsp;<A HREF="omake.html">Guide Home</A>
&bull;&nbsp;<A HREF="omake-doc.html">Guide (single-page)</A>
&bull;&nbsp;<A HREF="omake-toc.html">Contents (short)</A>
&bull;&nbsp;<A HREF="omake-contents.html">Contents (long)</A></TD>
</TR>
<TR><TD ALIGN=left NOWRAP>Index:</TD>
<TD VALIGN=top ALIGN=center NOWRAP>&nbsp;&nbsp;</TD>
<TD ALIGN=left NOWRAP><A HREF="omake-all-index.html">All</A>
&bull;&nbsp;<A HREF="omake-var-index.html">Variables</A>
&bull;&nbsp;<A HREF="omake-fun-index.html">Functions</A>
&bull;&nbsp;<A HREF="omake-obj-index.html">Objects</A>
&bull;&nbsp;<A HREF="omake-target-index.html">Targets</A>
&bull;&nbsp;<A HREF="omake-option-index.html">Options</A></TD>
</TR></TABLE>
</BODY>
</HTML>
